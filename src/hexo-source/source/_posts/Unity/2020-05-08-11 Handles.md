---
title: "Unity Handles å®Œå…¨æŒ‡å—ï¼šæ‰“é€ å¼ºå¤§çš„åœºæ™¯äº¤äº’æ‰‹æŸ„"
date: 2020/05/08
categories: [æŠ€æœ¯æ–‡ç« , Unityå¼€å‘]
tags: [Unity, UnityEditor, Handles, OnSceneGUI, ç¼–è¾‘å™¨æ‰©å±•, åœºæ™¯è§†å›¾]
image: /images/unity-handles-banner.jpg
---

# ğŸ® Unity Handles å®Œå…¨æŒ‡å—ï¼šæ‰“é€ å¼ºå¤§çš„åœºæ™¯äº¤äº’æ‰‹æŸ„

> ğŸ’¡ **åœºæ™¯äº¤äº’çš„åŠ›é‡**ï¼š
> - æƒ³åœ¨ Scene è§†å›¾ä¸­åˆ›å»ºè‡ªå®šä¹‰çš„å¯è§†åŒ–å·¥å…·ï¼Ÿ
> - å¦‚ä½•å®ç°ç±»ä¼¼ Unity å†…ç½®çš„ç§»åŠ¨ã€æ—‹è½¬ã€ç¼©æ”¾æ‰‹æŸ„ï¼Ÿ
> - OnSceneGUI å’Œ Handles æ€ä¹ˆé…åˆä½¿ç”¨ï¼Ÿ
> - æƒ³è®©å·¥å…·åœ¨åœºæ™¯è§†å›¾ä¸­æ›´ç›´è§‚ã€æ›´æ˜“ç”¨ï¼Ÿ
>
> **è¿™ç¯‡æ–‡ç« ï¼** å°†æ·±å…¥è®²è§£ Unity Handles æœºåˆ¶ï¼Œå¸®ä½ æ‰“é€ ä¸“ä¸šçº§åœºæ™¯äº¤äº’å·¥å…·ï¼

## ä¸€ã€Handles æ¦‚è¿°

`Handles` ç±»æä¾›äº†ä¸€å¥—åœ¨ Scene è§†å›¾ä¸­ç»˜åˆ¶ 3D GUI æ§ä»¶çš„èƒ½åŠ›ï¼Œæ˜¯è‡ªå®šä¹‰ç¼–è¾‘å™¨å·¥å…·çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚

### 1.1 æ ¸å¿ƒæ¦‚å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Scene åœºæ™¯è§†å›¾                       â”‚
â”‚                                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â”‚         OnSceneGUI ç»˜åˆ¶åŒºåŸŸ               â”‚       â”‚
â”‚    â”‚                                           â”‚       â”‚
â”‚    â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚       â”‚
â”‚    â”‚        â”‚  PositionHandle  â”‚ â† ä½ç½®æ‰‹æŸ„    â”‚       â”‚
â”‚    â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚       â”‚
â”‚    â”‚                                           â”‚       â”‚
â”‚    â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚       â”‚
â”‚    â”‚        â”‚  RotationHandle  â”‚ â† æ—‹è½¬æ‰‹æŸ„    â”‚       â”‚
â”‚    â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚       â”‚
â”‚    â”‚                                           â”‚       â”‚
â”‚    â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚       â”‚
â”‚    â”‚        â”‚  RadiusHandle    â”‚ â† èŒƒå›´æ‰‹æŸ„    â”‚       â”‚
â”‚    â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| ğŸ¯ **è·¯å¾„ç¼–è¾‘** | å¯è§†åŒ–ç¼–è¾‘è·¯å¾„ç‚¹ | æ›²çº¿ç¼–è¾‘å™¨ã€Waypoint ç³»ç»Ÿ |
| ğŸ° **åŒºåŸŸç¼–è¾‘** | å¯è§†åŒ–è®¾ç½®å½±å“èŒƒå›´ | AI å·¡é€»åŒºåŸŸã€è§¦å‘åŒºåŸŸ |
| ğŸ”§ **è‡ªå®šä¹‰å·¥å…·** | åˆ›å»ºä¸“ç”¨ç¼–è¾‘å·¥å…· | åœ°å½¢åˆ·å­ã€ç¯å…‰å¸ƒç½® |
| ğŸ“ **è¾…åŠ©çº¿** | ç»˜åˆ¶è°ƒè¯•ä¿¡æ¯ | å°„çº¿ã€åŒ…å›´ç›’ã€æ–¹å‘æŒ‡ç¤º |

### 1.3 åŸºæœ¬ç»“æ„

```csharp
using UnityEngine;
using UnityEditor;

[CustomEditor(typeof(ç›®æ ‡ç»„ä»¶))]
public class è‡ªå®šä¹‰ç¼–è¾‘å™¨ : Editor
{
    void OnSceneGUI()
    {
        // è·å–ç›®æ ‡ç»„ä»¶
        ç›®æ ‡ç»„ä»¶ç»„ä»¶ targetComponent = (ç›®æ ‡ç»„ä»¶)target;

        // å¼€å§‹ç»˜åˆ¶ Handles
        Handles.color = Color.yellow;

        // ä½¿ç”¨å„ç§ Handle å‡½æ•°...

        // å¦‚æœä¿®æ”¹äº†å€¼ï¼Œéœ€è¦æ ‡è®°åœºæ™¯ä¸ºå·²ä¿®æ”¹
        if (GUI.changed)
        {
            EditorUtility.SetDirty(targetComponent);
        }
    }
}
```

---

## äºŒã€å†…ç½® Handle ç±»å‹

Unity æä¾›äº†å¤šç§å†…ç½® Handle ç±»å‹ï¼Œæ»¡è¶³å¤§éƒ¨åˆ†å¸¸è§éœ€æ±‚ã€‚

### 2.1 ä½ç½®æ‰‹æŸ„ (PositionHandle)

åœ¨åœºæ™¯ä¸­åˆ›å»ºä¸€ä¸ªå¯æ‹–åŠ¨çš„ä½ç½®æ‰‹æŸ„ã€‚

```csharp
Vector3 position = transform.position;

// ä½¿ç”¨ Handles.PositionHandle åˆ›å»ºä½ç½®æ‰‹æŸ„
// å‚æ•°: å½“å‰ä½ç½®, æ—‹è½¬æ–¹å‘
// è¿”å›: æ–°ä½ç½®
position = Handles.PositionHandle(position, Quaternion.identity);

if (EditorGUI.EndChangeCheck())
{
    transform.position = position;
}
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PositionHandle             â”‚
â”‚                                    â”‚
â”‚           Y (ç»¿è‰²)                  â”‚
â”‚             â†‘                      â”‚
â”‚            /â”‚                      â”‚
â”‚           / â”‚                      â”‚
â”‚          /  â”‚                      â”‚
â”‚         â”€â”€â”€â”€â—â”€â”€â”€â”€â†’ X (çº¢è‰²)         â”‚
â”‚        /    Z (è“è‰²)                â”‚
â”‚       â†™                             â”‚
â”‚                                    â”‚
â”‚  å¯æ²¿ XYZ ä¸‰è½´æ‹–åŠ¨                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ—‹è½¬æ‰‹æŸ„ (RotationHandle)

åˆ›å»ºä¸€ä¸ªå¯è§†åŒ–çš„æ—‹è½¬æ‰‹æŸ„ã€‚

```csharp
Quaternion rotation = transform.rotation;

// ä½¿ç”¨ Handles.RotationHandle åˆ›å»ºæ—‹è½¬æ‰‹æŸ„
// å‚æ•°: å½“å‰æ—‹è½¬, ä¸­å¿ƒä½ç½®
// è¿”å›: æ–°æ—‹è½¬
rotation = Handles.RotationHandle(rotation, transform.position);

if (EditorGUI.EndChangeCheck())
{
    transform.rotation = rotation;
}
```

### 2.3 ç¼©æ”¾æ‰‹æŸ„ (ScaleHandle)

åˆ›å»ºç¼©æ”¾æ‰‹æŸ„ã€‚

```csharp
Vector3 scale = transform.localScale;

// ä½¿ç”¨ Handles.ScaleHandle åˆ›å»ºç¼©æ”¾æ‰‹æŸ„
// å‚æ•°: å½“å‰ç¼©æ”¾, ä¸­å¿ƒä½ç½®, æ—‹è½¬æ–¹å‘, å¤§å°
// è¿”å›: æ–°ç¼©æ”¾å€¼
scale = Handles.ScaleHandle(scale, transform.position, Quaternion.identity, 1f);

if (EditorGUI.EndChangeCheck())
{
    transform.localScale = scale;
}
```

### 2.4 åŠå¾„æ‰‹æŸ„ (RadiusHandle)

åˆ›å»ºä¸€ä¸ªåœ†å½¢çš„åŠå¾„è°ƒèŠ‚æ‰‹æŸ„ã€‚

```csharp
float radius = 5f;

// ä½¿ç”¨ Handles.RadiusHandle åˆ›å»ºåŠå¾„æ‰‹æŸ„
// å‚æ•°: æ—‹è½¬æ–¹å‘, ä¸­å¿ƒä½ç½®, å½“å‰åŠå¾„
// è¿”å›: æ–°åŠå¾„å€¼
radius = Handles.RadiusHandle(Quaternion.identity, transform.position, radius);

if (GUI.changed)
{
    Debug.Log($"æ–°åŠå¾„: {radius}");
}
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         RadiusHandle               â”‚
â”‚                                    â”‚
â”‚         â•­â”€â”€â”€â”€â”€â”€â”€â”€â•®                 â”‚
â”‚       â•­â”€â”€â•¯        â•°â”€â”€â•®              â”‚
â”‚      â”‚  â—â”€â”€â”€â”€â”€â”€â”€â—    â”‚  â† æ‹–åŠ¨åœ†å‘¨  â”‚
â”‚      â”‚    â•²   â•±      â”‚     è°ƒæ•´åŠå¾„  â”‚
â”‚       â•°â”€â”€â•¯        â•­â”€â”€â•¯              â”‚
â”‚         â•°â”€â”€â”€â”€â”€â”€â”€â”€â•¯                 â”‚
â”‚                                    â”‚
â”‚  å¸¸ç”¨äº: AI å·¡é€»èŒƒå›´ã€è§¦å‘åŒºåŸŸ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.5 æ–¹å‘æ‰‹æŸ„ (ArrowHandle)

åˆ›å»ºä¸€ä¸ªæŒ‡å‘æ€§ç®­å¤´ã€‚

```csharp
Vector3 position = transform.position;
Vector3 direction = transform.forward;
float size = 1f;

// ä½¿ç”¨ Handles.ArrowHandle åˆ›å»ºç®­å¤´æ‰‹æŸ„
// å‚æ•°: ä½ç½®, æ–¹å‘, å¤§å°
Handles.ArrowHandle(0, position, Quaternion.LookRotation(direction), size);
```

### 2.6 æ•°å€¼ç¼©æ”¾æ‰‹æŸ„ (ScaleValueHandle)

åˆ›å»ºä¸€ä¸ªå¯æ‹–åŠ¨çš„æ»‘å—æ¥è°ƒæ•´æ•°å€¼ã€‚

```csharp
float size = 1f;

// ä½¿ç”¨ Handles.ScaleValueHandle åˆ›å»ºæ•°å€¼ç¼©æ”¾æ‰‹æŸ„
// å‚æ•°: å½“å‰å€¼, ä½ç½®, æ—‹è½¬, å¤§å°, æ‰‹æŸ„ç±»å‹, æˆªæ–­æ¯”ä¾‹
// è¿”å›: æ–°æ•°å€¼
size = Handles.ScaleValueHandle(
    size,
    transform.position + Vector3.up * 2,
    Quaternion.identity,
    2f,
    Handles.ArrowHandleCap,
    0.5f
);
```

---

## ä¸‰ã€Handle Capsï¼ˆæ‰‹æŸ„æ ·å¼ï¼‰

Handle Cap æ˜¯æ‰‹æŸ„çš„è§†è§‰è¡¨ç°æ ·å¼ã€‚

### 3.1 å†…ç½® Cap ç±»å‹

| Cap ç±»å‹ | æè¿° | é€‚ç”¨åœºæ™¯ |
|---------|------|---------|
| `SphereCap` | çƒä½“ | ç‚¹ä½ç½®æ ‡è®° |
| `CircleCap` | åœ†å½¢ | åŒºåŸŸæ ‡è®° |
| `RectangleCap` | çŸ©å½¢ | çŸ©å½¢åŒºåŸŸ |
| `ArrowCap` | ç®­å¤´ | æ–¹å‘æŒ‡ç¤º |
| `CubeCap` | ç«‹æ–¹ä½“ | ä½“ç§¯æ ‡è®° |
| `CylinderCap` | åœ†æŸ± | æŸ±çŠ¶åŒºåŸŸ |
| `ConeCap` | åœ†é”¥ | æ–¹å‘+ä½“ç§¯ |
| `DotCap` | ç‚¹ | ç²¾ç¡®ä½ç½® |

### 3.2 ä½¿ç”¨ Cap çš„ç¤ºä¾‹

```csharp
void OnSceneGUI()
{
    Vector3 position = transform.position;
    float size = 1f;

    // ç»˜åˆ¶ä¸åŒç±»å‹çš„ Cap
    Handles.SphereHandle(0, position + Vector3.left * 2, Quaternion.identity, size, EventType.Repaint);
    Handles.CircleHandle(0, position + Vector3.right * 2, Quaternion.identity, size, EventType.Repaint);
    Handles.CubeHandle(0, position + Vector3.up * 2, Quaternion.identity, size, EventType.Repaint);

    // è‡ªå®šä¹‰ç»˜åˆ¶ ArrowCap
    Handles.ArrowCap(0, position + Vector3.down * 2, Quaternion.identity, size);
}
```

---

## å››ã€ç»˜åˆ¶å½¢çŠ¶ä¸çº¿æ¡

Handles ç±»è¿˜æä¾›äº†ç›´æ¥ç»˜åˆ¶å½¢çŠ¶å’Œçº¿æ¡çš„æ–¹æ³•ã€‚

### 4.1 åŸºæœ¬å½¢çŠ¶ç»˜åˆ¶

| æ–¹æ³• | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| `Handles.DrawLine()` | ç»˜åˆ¶çº¿æ®µ | `DrawLine(start, end)` |
| `Handles.DrawDottedLine()` | ç»˜åˆ¶è™šçº¿ | `DrawDottedLine(start, end)` |
| `Handles.DrawWireDisc()` | ç»˜åˆ¶åœ†å½¢è½®å»“ | `DrawWireDisc(center, normal, radius)` |
| `Handles.DrawSolidDisc()` | ç»˜åˆ¶å®å¿ƒåœ† | `DrawSolidDisc(center, normal, radius)` |
| `Handles.DrawWireArc()` | ç»˜åˆ¶åœ†å¼§ | `DrawWireArc(center, normal, from, angle, radius)` |

### 4.2 å½¢çŠ¶ç»˜åˆ¶ç¤ºä¾‹

```csharp
void OnSceneGUI()
{
    Transform targetTransform = ((MonoBehaviour)target).transform;

    // ç»˜åˆ¶è¿æ¥çº¿
    Handles.color = Color.white;
    Handles.DrawLine(targetTransform.position, targetTransform.position + Vector3.forward * 5);

    // ç»˜åˆ¶è™šçº¿
    Handles.color = Color.gray;
    Handles.DrawDottedLine(targetTransform.position, targetTransform.position + Vector3.right * 5);

    // ç»˜åˆ¶åœ†å½¢åŒºåŸŸ
    Handles.color = new Color(1, 0, 0, 0.3f);
    Handles.DrawWireDisc(targetTransform.position, Vector3.up, 3f);

    // ç»˜åˆ¶åœ†å¼§
    Handles.color = Color.green;
    Handles.DrawWireArc(
        targetTransform.position + Vector3.up * 2,
        Vector3.forward,
        Vector3.right,
        90f,
        2f
    );
}
```

### 4.3 ç»˜åˆ¶ 3D å½¢çŠ¶

```csharp
void OnSceneGUI()
{
    Vector3 position = transform.position;

    // ç»˜åˆ¶çº¿æ¡†ç«‹æ–¹ä½“
    Handles.color = Color.cyan;
    Handles.DrawWireCube(position, Vector3.one * 2);

    // ç»˜åˆ¶çº¿æ¡†çƒä½“
    Handles.color = Color.yellow;
    Handles.DrawWireSphere(position + Vector3.right * 3, 1f);

    // ç»˜åˆ¶çº¿æ¡†èƒ¶å›Šä½“
    Handles.color = Color.magenta;
    Handles.DrawWireCapsule(position + Vector3.left * 3, Quaternion.identity, 2f, 0.5f);
}
```

---

## äº”ã€é¢œè‰²ä¸æ ·å¼

### 5.1 è®¾ç½®é¢œè‰²

```csharp
void OnSceneGUI()
{
    // è®¾ç½®æ‰€æœ‰åç»­ Handles çš„é¢œè‰²
    Handles.color = Color.red;

    Handles.DrawWireDisc(transform.position, Vector3.up, 2f);

    // ä¹Ÿå¯ä»¥è®¾ç½®å¸¦é€æ˜åº¦çš„é¢œè‰²
    Handles.color = new Color(1, 0, 0, 0.5f); // åŠé€æ˜çº¢è‰²
}
```

### 5.2 çŸ©é˜µå˜æ¢

```csharp
void OnSceneGUI()
{
    // ä¿å­˜å½“å‰çŸ©é˜µ
    Matrix4x4 originalMatrix = Handles.matrix;

    // åº”ç”¨è‡ªå®šä¹‰å˜æ¢çŸ©é˜µ
    Handles.matrix = Matrix4x4.TRS(
        transform.position,    // ä½ç½®
        transform.rotation,    // æ—‹è½¬
        transform.localScale   // ç¼©æ”¾
    );

    // åœ¨å˜æ¢åçš„ç©ºé—´ä¸­ç»˜åˆ¶
    Handles.DrawWireCube(Vector3.zero, Vector3.one);

    // æ¢å¤åŸå§‹çŸ©é˜µ
    Handles.matrix = originalMatrix;
}
```

### 5.3 å…‰ç…§

```csharp
void OnSceneGUI()
{
    // è®¾ç½®å…‰ç…§æ–¹å‘
    Handles.lighting = true;

    // ç»˜åˆ¶å¸¦æœ‰å…‰ç…§æ•ˆæœçš„å½¢çŠ¶
    Handles.SphereHandle(0, transform.position, Quaternion.identity, 1f, EventType.Repaint);
}
```

---

## å…­ã€æ ‡ç­¾ä¸è¾…åŠ©ä¿¡æ¯

### 6.1 Label æ ‡ç­¾

```csharp
void OnSceneGUI()
{
    Vector3 position = transform.position;

    // åœ¨åœºæ™¯ä¸­ç»˜åˆ¶æ–‡æœ¬æ ‡ç­¾
    Handles.Label(
        position + Vector3.up * 2,
        $"<size=24><color=yellow>{gameObject.name}</color></size>\n" +
        $"Pos: {position}\n" +
        $"HP: {100}"
    );
}
```

### 6.2 ä½¿ç”¨ GUIStyle

```csharp
void OnSceneGUI()
{
    GUIStyle style = new GUIStyle()
    {
        fontSize = 16,
        fontStyle = FontStyle.Bold,
        normal = { textColor = Color.yellow },
        alignment = TextAnchor.MiddleCenter
    };

    Handles.Label(transform.position + Vector3.up * 3, "è‡ªå®šä¹‰æ ‡ç­¾æ ·å¼", style);
}
```

---

## ä¸ƒã€å®Œæ•´ç¤ºä¾‹ï¼šè·¯å¾„ç¼–è¾‘å™¨

ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„è·¯å¾„ç‚¹ç¼–è¾‘å™¨ç¤ºä¾‹ã€‚

### 7.1 ç›®æ ‡ç»„ä»¶

```csharp
using UnityEngine;

/// <summary>
/// è·¯å¾„ç»„ä»¶ - å®šä¹‰ä¸€ç³»åˆ—è·¯å¾„ç‚¹
/// </summary>
public class PathComponent : MonoBehaviour
{
    [Header("è·¯å¾„è®¾ç½®")]
    public Vector3[] waypoints = new Vector3[0];
    public bool loop = false;
    public Color pathColor = Color.cyan;
    public float pointSize = 0.2f;
}
```

### 7.2 è‡ªå®šä¹‰ç¼–è¾‘å™¨

```csharp
using UnityEngine;
using UnityEditor;

[CustomEditor(typeof(PathComponent))]
public class PathComponentEditor : Editor
{
    private PathComponent path;
    private SerializedProperty waypointsProperty;
    private SerializedProperty loopProperty;
    private SerializedProperty pathColorProperty;

    void OnEnable()
    {
        path = (PathComponent)target;
        waypointsProperty = serializedObject.FindProperty("waypoints");
        loopProperty = serializedObject.FindProperty("loop");
        pathColorProperty = serializedObject.FindProperty("pathColor");
    }

    public override void OnInspectorGUI()
    {
        serializedObject.Update();

        EditorGUILayout.LabelField("è·¯å¾„ç¼–è¾‘å™¨", EditorStyles.boldLabel);
        EditorGUILayout.Space();

        EditorGUILayout.PropertyField(loopProperty);
        EditorGUILayout.PropertyField(pathColorProperty);
        EditorGUILayout.PropertyField(waypointsProperty, true);

        // æ˜¾ç¤ºè·¯å¾„æ€»é•¿åº¦
        if (path.waypoints != null && path.waypoints.Length > 1)
        {
            float length = CalculatePathLength();
            EditorGUILayout.HelpBox($"è·¯å¾„æ€»é•¿åº¦: {length:F2} å•ä½", MessageType.Info);
        }

        EditorGUILayout.Space();

        // æ·»åŠ /æ¸…é™¤æŒ‰é’®
        EditorGUILayout.BeginHorizontal();
        if (GUILayout.Button("æ·»åŠ å½“å‰ç›¸æœºä½ç½®"))
        {
            AddWaypointFromCamera();
        }
        if (GUILayout.Button("æ¸…é™¤æ‰€æœ‰ç‚¹"))
        {
            if (EditorUtility.DisplayDialog("ç¡®è®¤", "ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰è·¯å¾„ç‚¹å—ï¼Ÿ", "ç¡®å®š", "å–æ¶ˆ"))
            {
                waypointsProperty.ClearArray();
                serializedObject.ApplyModifiedProperties();
            }
        }
        EditorGUILayout.EndHorizontal();

        serializedObject.ApplyModifiedProperties();
    }

    void OnSceneGUI()
    {
        if (path.waypoints == null || path.waypoints.Length == 0)
            return;

        // è®¾ç½®é¢œè‰²
        Handles.color = path.pathColor;

        // ç»˜åˆ¶è·¯å¾„çº¿
        for (int i = 0; i < path.waypoints.Length - 1; i++)
        {
            Handles.DrawDottedLine(
                path.waypoints[i],
                path.waypoints[i + 1],
                2f
            );
        }

        // ç»˜åˆ¶å¾ªç¯çº¿
        if (path.loop && path.waypoints.Length > 2)
        {
            Handles.DrawDottedLine(
                path.waypoints[path.waypoints.Length - 1],
                path.waypoints[0],
                2f
            );
        }

        // ç»˜åˆ¶å’Œç¼–è¾‘è·¯å¾„ç‚¹
        for (int i = 0; i < path.waypoints.Length; i++)
        {
            EditorGUI.BeginChangeCheck();

            // ä½¿ç”¨ SphereCap ä½œä¸ºæ‰‹æŸ„æ ·å¼
            Vector3 newPosition = Handles.PositionHandle(
                path.waypoints[i],
                Quaternion.identity
            );

            // ç»˜åˆ¶ç‚¹åºå·
            Handles.Label(
                path.waypoints[i] + Vector3.up * 0.5f,
                $"<color=yellow>{i}</color>"
            );

            if (EditorGUI.EndChangeCheck())
            {
                Undo.RecordObject(path, "Move Waypoint");
                path.waypoints[i] = newPosition;
                EditorUtility.SetDirty(path);
            }
        }

        // ç»˜åˆ¶æ–¹å‘æŒ‡ç¤º
        DrawPathDirection();
    }

    private float CalculatePathLength()
    {
        if (path.waypoints.Length < 2)
            return 0f;

        float length = 0f;
        for (int i = 0; i < path.waypoints.Length - 1; i++)
        {
            length += Vector3.Distance(path.waypoints[i], path.waypoints[i + 1]);
        }

        if (path.loop && path.waypoints.Length > 2)
        {
            length += Vector3.Distance(
                path.waypoints[path.waypoints.Length - 1],
                path.waypoints[0]
            );
        }

        return length;
    }

    private void AddWaypointFromCamera()
    {
        Vector3 cameraPos = SceneView.lastActiveSceneView.camera.transform.position;
        waypointsProperty.arraySize++;
        waypointsProperty.GetArrayElementAtIndex(waypointsProperty.arraySize - 1).vector3Value = cameraPos;
        serializedObject.ApplyModifiedProperties();
    }

    private void DrawPathDirection()
    {
        if (path.waypoints.Length < 2)
            return;

        Handles.color = Color.yellow;

        for (int i = 0; i < path.waypoints.Length - 1; i++)
        {
            Vector3 dir = (path.waypoints[i + 1] - path.waypoints[i]).normalized;
            Vector3 mid = (path.waypoints[i] + path.waypoints[i + 1]) * 0.5f;
            Handles.ArrowCap(0, mid, Quaternion.LookRotation(dir), 0.5f);
        }

        if (path.loop && path.waypoints.Length > 2)
        {
            Vector3 dir = (path.waypoints[0] - path.waypoints[path.waypoints.Length - 1]).normalized;
            Vector3 mid = (path.waypoints[0] + path.waypoints[path.waypoints.Length - 1]) * 0.5f;
            Handles.ArrowCap(0, mid, Quaternion.LookRotation(dir), 0.5f);
        }
    }
}
```

### 7.3 æ•ˆæœå±•ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Scene åœºæ™¯è§†å›¾                       â”‚
â”‚                                                         â”‚
â”‚    0 â”€â”€â”€â”€â”€â”€â†’ 1 â”€â”€â”€â”€â”€â”€â†’ 2 â”€â”€â”€â”€â”€â”€â†’ 3                    â”‚
â”‚    â”‚              â•²                                     â”‚
â”‚    â”‚               â•²                                    â”‚
â”‚    â†â”€â”€â”€â”€ 5 â†â”€â”€â”€â”€ 4                                      â”‚
â”‚                                                         â”‚
â”‚  â— = PositionHandle (å¯æ‹–åŠ¨)                           â”‚
â”‚  â†’ = æ–¹å‘æŒ‡ç¤ºç®­å¤´                                       â”‚
â”‚  â”€â”€ = è·¯å¾„è¿æ¥çº¿ (è™šçº¿)                                â”‚
â”‚  æ•°å­— = ç‚¹åºå·æ ‡ç­¾                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…«ã€å®Œæ•´ç¤ºä¾‹ï¼šAI å·¡é€»èŒƒå›´ç¼–è¾‘å™¨

```csharp
using UnityEngine;
using UnityEditor;

/// <summary>
/// AI å·¡é€»ç»„ä»¶
/// </summary>
public class AIPatrol : MonoBehaviour
{
    [Header("å·¡é€»è®¾ç½®")]
    public float patrolRadius = 5f;
    public float chaseRadius = 10f;
    public Color patrolColor = new Color(0, 1, 0, 0.3f);
    public Color chaseColor = new Color(1, 0, 0, 0.3f);
}

/// <summary>
/// AI å·¡é€»ç¼–è¾‘å™¨
/// </summary>
[CustomEditor(typeof(AIPatrol))]
public class AIPatrolEditor : Editor
{
    private AIPatrol patrol;
    private SerializedProperty patrolRadiusProp;
    private SerializedProperty chaseRadiusProp;

    void OnEnable()
    {
        patrol = (AIPatrol)target;
        patrolRadiusProp = serializedObject.FindProperty("patrolRadius");
        chaseRadiusProp = serializedObject.FindProperty("chaseRadius");
    }

    void OnSceneGUI()
    {
        Vector3 position = patrol.transform.position;
        position.y = 0f; // ä¿æŒåœ¨å¹³é¢ä¸Š

        // ç»˜åˆ¶å·¡é€»èŒƒå›´ï¼ˆç»¿è‰²ï¼‰
        Handles.color = patrol.patrolColor;
        EditorGUI.BeginChangeCheck();
        float newPatrolRadius = Handles.RadiusHandle(
            Quaternion.identity,
            position,
            patrol.patrolRadius
        );

        if (EditorGUI.EndChangeCheck())
        {
            Undo.RecordObject(patrol, "Change Patrol Radius");
            patrol.patrolRadius = newPatrolRadius;
        }

        // ç»˜åˆ¶è¿½å‡»èŒƒå›´ï¼ˆçº¢è‰²ï¼‰
        Handles.color = patrol.chaseColor;
        EditorGUI.BeginChangeCheck();
        float newChaseRadius = Handles.RadiusHandle(
            Quaternion.identity,
            position,
            patrol.chaseRadius
        );

        if (EditorGUI.EndChangeCheck())
        {
            Undo.RecordObject(patrol, "Change Chase Radius");
            patrol.chaseRadius = newChaseRadius;
        }

        // ç»˜åˆ¶æ ‡ç­¾
        Handles.Label(
            position + Vector3.up * 0.1f,
            $"<color=green>å·¡é€»: {patrol.patrolRadius:F1}m</color>\n" +
            $"<color=red>è¿½å‡»: {patrol.chaseRadius:F1}m</color>"
        );

        if (GUI.changed)
        {
            EditorUtility.SetDirty(patrol);
        }
    }

    public override void OnInspectorGUI()
    {
        serializedObject.Update();

        EditorGUILayout.LabelField("AI å·¡é€»èŒƒå›´è®¾ç½®", EditorStyles.boldLabel);
        EditorGUILayout.Space();

        EditorGUILayout.PropertyField(patrolRadiusProp, new GUIContent("å·¡é€»åŠå¾„"));
        EditorGUILayout.PropertyField(chaseRadiusProp, new GUIContent("è¿½å‡»åŠå¾„"));

        serializedObject.ApplyModifiedProperties();
    }
}
```

---

## ä¹ã€Handles å¸¸ç”¨æ–¹æ³•é€ŸæŸ¥è¡¨

| æ–¹æ³• | æè¿° | è¿”å›å€¼ |
|------|------|--------|
| **ä½ç½®ç›¸å…³** |||
| `PositionHandle()` | ä½ç½®æ‰‹æŸ„ | `Vector3` |
| **æ—‹è½¬ç›¸å…³** |||
| `RotationHandle()` | æ—‹è½¬æ‰‹æŸ„ | `Quaternion` |
| **ç¼©æ”¾ç›¸å…³** |||
| `ScaleHandle()` | ç¼©æ”¾æ‰‹æŸ„ | `Vector3` |
| `ScaleValueHandle()` | æ•°å€¼ç¼©æ”¾æ‰‹æŸ„ | `float` |
| **å½¢çŠ¶ç›¸å…³** |||
| `RadiusHandle()` | åŠå¾„æ‰‹æŸ„ | `float` |
| `Slider()` | æ»‘åŠ¨æ‰‹æŸ„ | `float` |
| `ArrowHandle()` | ç®­å¤´æ‰‹æŸ„ | - |
| **ç»˜åˆ¶ç›¸å…³** |||
| `DrawLine()` | ç»˜åˆ¶çº¿æ®µ | - |
| `DrawDottedLine()` | ç»˜åˆ¶è™šçº¿ | - |
| `DrawWireDisc()` | ç»˜åˆ¶åœ†è½®å»“ | - |
| `DrawSolidDisc()` | ç»˜åˆ¶å®å¿ƒåœ† | - |
| `DrawWireArc()` | ç»˜åˆ¶åœ†å¼§ | - |
| `DrawWireCube()` | ç»˜åˆ¶çº¿æ¡†ç«‹æ–¹ä½“ | - |
| `DrawWireSphere()` | ç»˜åˆ¶çº¿æ¡†çƒä½“ | - |
| **è¾…åŠ©ç›¸å…³** |||
| `Label()` | ç»˜åˆ¶æ–‡æœ¬æ ‡ç­¾ | - |
| `DotHandle()` | ç»˜åˆ¶ç‚¹æ ‡è®° | - |

---

## åã€æœ€ä½³å®è·µ

### 10.1 å˜æ›´æ£€æµ‹

```csharp
void OnSceneGUI()
{
    EditorGUI.BeginChangeCheck();

    // Handle æ“ä½œ...

    if (EditorGUI.EndChangeCheck())
    {
        Undo.RecordObject(target, "Handle Change");
        EditorUtility.SetDirty(target);
    }
}
```

### 10.2 æ€§èƒ½ä¼˜åŒ–

```csharp
// åªåœ¨é‡ç»˜äº‹ä»¶æ—¶ç»˜åˆ¶å¤æ‚å½¢çŠ¶
void OnSceneGUI()
{
    if (Event.current.type == EventType.Repaint)
    {
        // å¤æ‚ç»˜åˆ¶æ“ä½œ...
    }

    // Handle æ“ä½œå§‹ç»ˆæ‰§è¡Œ
    position = Handles.PositionHandle(position, Quaternion.identity);
}
```

### 10.3 ç”¨æˆ·ä½“éªŒ

```csharp
// ä½¿ç”¨æœ‰æ„ä¹‰çš„é¢œè‰²
Handles.color = Color.green;      // å®‰å…¨åŒºåŸŸ
Handles.color = Color.yellow;     // è­¦å‘ŠåŒºåŸŸ
Handles.color = Color.red;        // å±é™©åŒºåŸŸ

// æ·»åŠ æ ‡ç­¾è¯´æ˜
Handles.Label(position, "æ‹–åŠ¨è°ƒæ•´ä½ç½®");

// æä¾›è§†è§‰åé¦ˆ
if (value > maxValue)
{
    Handles.color = Color.red;
    Handles.Label(position, "å€¼è¶…å‡ºèŒƒå›´!");
}
```

---

## åä¸€ã€æ€»ç»“

æœ¬æ–‡ä»‹ç»äº† Unity Handles çš„æ ¸å¿ƒçŸ¥è¯†ï¼š

| ä¸»é¢˜ | è¦ç‚¹ |
|------|------|
| **åŸºæœ¬æ¦‚å¿µ** | Scene è§†å›¾ä¸­çš„ 3D GUI æ§ä»¶ |
| **æ ¸å¿ƒæ–¹æ³•** | OnSceneGUI ä¸­è°ƒç”¨ Handles API |
| **å¸¸ç”¨ Handle** | PositionHandle, RotationHandle, ScaleHandle, RadiusHandle |
| **Handle Caps** | SphereCap, CircleCap, ArrowCap ç­‰æ ·å¼ |
| **ç»˜åˆ¶æ–¹æ³•** | DrawLine, DrawWireDisc, DrawWireArc ç­‰ |
| **è¾…åŠ©åŠŸèƒ½** | Label æ ‡ç­¾, color é¢œè‰², matrix å˜æ¢ |
| **æœ€ä½³å®è·µ** | ä½¿ç”¨ Undo è®°å½•ï¼Œæ£€æµ‹å˜æ›´ï¼Œä¼˜åŒ–æ€§èƒ½ |

> ğŸ’¡ **å¼€å‘å»ºè®®**ï¼š
> - æ‰€æœ‰ Handle æ“ä½œéƒ½åº”è¯¥æ”¾åœ¨ OnSceneGUI ä¸­
> - ä½¿ç”¨ EditorGUI.BeginChangeCheck/EndChangeCheck æ£€æµ‹å˜æ›´
> - ä¿®æ”¹å¯¹è±¡å‰è°ƒç”¨ Undo.RecordObject è®°å½•æ’¤é”€
> - ä½¿ç”¨åˆé€‚çš„é¢œè‰²å’Œæ ‡ç­¾æå‡ç”¨æˆ·ä½“éªŒ
> - å¤æ‚ç»˜åˆ¶åªåœ¨ EventType.Repaint æ—¶æ‰§è¡Œ

---

**è½¬è½½è¯·æ³¨æ˜æ¥æº**ï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºï¼Œä¹Ÿå¯ä»¥é‚®ä»¶è‡³ 1487842110@qq.com
