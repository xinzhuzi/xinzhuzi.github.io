---
title: "Unity GPU æ¸²æŸ“ä¼˜åŒ–å®Œå…¨æ‰‹å†Œï¼šä» DrawCall åˆ° Shader çš„æ€§èƒ½é£è·ƒ"
date: 2020/05/08
categories: [æŠ€æœ¯æ–‡ç« , Unityå¼€å‘]
tags: [Unity, GPUä¼˜åŒ–, æ¸²æŸ“, Shader, æ€§èƒ½, DrawCall, Batch, OverDraw, LOD, Mobile]
image: /images/unity-gpu-optimization-banner.jpg
---

# ğŸ® Unity GPU æ¸²æŸ“ä¼˜åŒ–å®Œå…¨æ‰‹å†Œï¼šä» DrawCall åˆ° Shader çš„æ€§èƒ½é£è·ƒ

> ğŸ’¡ **GPU ä¼˜åŒ–çš„ä»·å€¼**ï¼š
> - DrawCall å±…é«˜ä¸ä¸‹ï¼Œå¸§ç‡æä¸ä¸Šæ¥ï¼Ÿ
> - OverDraw å¤ªä¸¥é‡ï¼ŒGPU å‹åŠ›è¿‡å¤§ï¼Ÿ
> - æƒ³ä¼˜åŒ– Shaderï¼Œå´ä¸çŸ¥ä»ä½•å…¥æ‰‹ï¼Ÿ
> - ç§»åŠ¨å¹³å°ä¼˜åŒ–æœ‰å“ªäº›ç‰¹æ®Šæ³¨æ„äº‹é¡¹ï¼Ÿ
>
> **è¿™ç¯‡æ–‡ç« ï¼** å°†ç³»ç»Ÿè®²è§£ Unity GPU ä¼˜åŒ–æŠ€æœ¯ï¼Œä»æ¸²æŸ“ç®¡çº¿åˆ°ç€è‰²å™¨ï¼Œè®©ç”»é¢æ›´æµç•…ï¼

---

## ä¸€ã€GPU æ€§èƒ½ç“¶é¢ˆåˆ†æ

### 1.1 GPU ç“¶é¢ˆç±»å‹

| ç“¶é¢ˆç±»å‹ | ç‰¹å¾ | æ£€æµ‹æ–¹æ³• |
|---------|------|---------|
| **åƒç´ å¡«å……å—é™** | åˆ†è¾¨ç‡é«˜ã€OverDraw ä¸¥é‡ | Frame Debugger / RenderDoc |
| **é¡¶ç‚¹å¤„ç†å—é™** | é¡¶ç‚¹æ•°å¤šã€å¤æ‚å‡ ä½•ä½“ | å‡å°‘é¡¶ç‚¹æ•°æµ‹è¯• |
| **å¸¦å®½å—é™** | çº¹ç†é‡‡æ ·å¤šã€é«˜åˆ†è¾¨ç‡çº¹ç† | é™ä½çº¹ç†åˆ†è¾¨ç‡æµ‹è¯• |
| **ç®—åŠ›å—é™** | å¤æ‚ç€è‰²å™¨è®¡ç®— | ç®€åŒ– Shader æµ‹è¯• |

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GPU æ¸²æŸ“ç®¡çº¿ç“¶é¢ˆå®šä½                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  åº”ç”¨é˜¶æ®µ            å‡ ä½•é˜¶æ®µ           å…‰æ …åŒ–é˜¶æ®µ        åƒç´ å¤„ç†é˜¶æ®µ   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ CPU     â”‚â”€â”€â”€â”€â”€â”€>â”‚ é¡¶ç‚¹ç€è‰² â”‚â”€â”€â”€â”€â”€â”€>â”‚ è£å‰ª/   â”‚â”€â”€â”€â”€â”€>â”‚ åƒç´ ç€è‰² â”‚    â”‚
â”‚  â”‚ å‡†å¤‡æ•°æ® â”‚       â”‚   å™¨    â”‚       â”‚ é€è§†é™¤æ³•â”‚      â”‚   å™¨    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚       â”‚                 â”‚                 â”‚                 â”‚         â”‚
â”‚       â–¼                 â–¼                 â–¼                 â–¼         â”‚
â”‚   Draw Calls        é¡¶ç‚¹æ•°é‡           å›¾å…ƒæ•°é‡        åƒç´ å¡«å……ç‡      â”‚
â”‚   åˆæ‰¹ä¼˜åŒ–          LOD ä¼˜åŒ–          è£å‰ªä¼˜åŒ–        OverDown ä¼˜åŒ–    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ€§èƒ½åˆ†æå·¥å…·

| å·¥å…· | å¹³å° | ç”¨é€” |
|-----|------|------|
| **Unity Profiler** | å…¨å¹³å° | æ•´ä½“æ€§èƒ½åˆ†æ |
| **Frame Debugger** | Editor | å•å¸§æ¸²æŸ“åˆ†æ |
| **RenderDoc** | Desktop | è¯¦ç»† GPU åˆ†æ |
| **Xcode Instruments** | iOS | GPU Driver / Tiler |
| **Snapdragon Profiler** | Android | Adreno GPU åˆ†æ |
| **Mali Graphics Debugger** | Android | Mali GPU åˆ†æ |

---

## äºŒã€DrawCall ä¼˜åŒ–

### 2.1 DrawCall åŸç†

```
å•ä¸ª DrawCall çš„å¼€é”€:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CPU å‡†å¤‡   â”‚  æ•°æ®ä¼ è¾“   â”‚  GPU çŠ¶æ€   â”‚  æ¸²æŸ“æ‰§è¡Œ   â”‚
â”‚  æ¸²æŸ“çŠ¶æ€   â”‚  åˆ° GPU     â”‚  åˆ‡æ¢       â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘                 â†‘                â†‘
  [å›ºå®šå¼€é”€]      [å¸¦å®½å¼€é”€]       [çŠ¶æ€åˆ‡æ¢å¼€é”€]
```

### 2.2 åˆæ‰¹æŠ€æœ¯

| æŠ€æœ¯ | åŸç† | é€‚ç”¨åœºæ™¯ | é™åˆ¶ |
|-----|------|---------|------|
| **Static Batch** | è¿è¡Œå‰åˆå¹¶é™æ€å‡ ä½•ä½“ | ä¸ç§»åŠ¨çš„åœºæ™¯ç‰©ä½“ | å†…å­˜å¢åŠ  |
| **Dynamic Batch** | è¿è¡Œæ—¶åˆå¹¶å°ç½‘æ ¼ | <900é¡¶ç‚¹çš„åŠ¨æ€ç‰©ä½“ | é¡¶ç‚¹æ•°é™åˆ¶ |
| **GPU Instancing** | å•æ¬¡ç»˜åˆ¶å¤šå®ä¾‹ | ç›¸åŒæè´¨çš„é‡å¤ç‰©ä½“ | éœ€è¦ Shader æ”¯æŒ |
| **SRP Batcher** | æŒ‰Shaderå˜ä½“åˆ†ç»„ | å¯ç¼–ç¨‹æ¸²æŸ“ç®¡çº¿ | Shader å…¼å®¹æ€§ |

### 2.3 Static Batching

```csharp
// âœ… è®¾ç½®é™æ€æ ‡å¿—
gameObject.isStatic = true;

// æˆ–åœ¨ Inspector ä¸­å‹¾é€‰ Static

// è¿è¡Œæ—¶ Static Batching:
// Editor: Build Player æ—¶è‡ªåŠ¨åˆå¹¶
// Runtime: StaticBatchingUtility.CombineRoots(combined);
```

| ä¼˜ç‚¹ | ç¼ºç‚¹ |
|-----|------|
| å¤§å¹…å‡å°‘ DC | å†…å­˜å¢åŠ  (åˆå¹¶å¤šä»½ç½‘æ ¼) |
| è¿è¡Œæ—¶æ— å¼€é”€ | ä¸é€‚åˆåŠ¨æ€ç‰©ä½“ |
| è·¨å¹³å°å…¼å®¹ | åˆå¹¶åæ— æ³•å•ç‹¬ç§»åŠ¨ |

### 2.4 Dynamic Batching

```csharp
// âœ… å¯ç”¨åŠ¨æ€æ‰¹å¤„ç†
PlayerSettings.SetMobileMTRendering(BuildTargetGroup.Android, false);
PlayerSettings.SetMobileMTRendering(BuildTargetGroup.iOS, false);

// åŠ¨æ€æ‰¹å¤„ç†é™åˆ¶:
// - é¡¶ç‚¹æ•° < 900 (ç§»åŠ¨ç«¯æ›´ä¸¥æ ¼)
// - ç›¸åŒ Material
// - ç›¸åŒ Shader å˜ä½“
// - ä¸ä½¿ç”¨å¤š Pass Shader
```

### 2.5 GPU Instancing

```csharp
// âœ… Shader å¯ç”¨ Instancing
#pragma multi_compile_instancing

// MeshRenderer å¯ç”¨
MeshRenderer renderer = GetComponent<MeshRenderer>();
renderer.enableInstancing = true;

// Graphics.DrawMeshInstanced
Matrix4x4[] matrices = new Matrix4x4[instancesCount];
Graphics.DrawMeshInstanced(mesh, 0, material, matrices);
```

> ğŸ’¡ **æç¤º**ï¼šGPU Instancing æ˜¯ç§»åŠ¨ç«¯çš„é¦–é€‰åˆæ‰¹æ–¹å¼ï¼

---

## ä¸‰ã€OverDraw ä¼˜åŒ–

### 3.1 OverDraw é—®é¢˜

```
OverDraw ç¤ºæ„å›¾:
    ç›¸æœºè§†é‡
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â•”â•â•â•â•—  â•”â•â•â•â•—      â”‚  æ¯ä¸ªæ–¹å—è¢«ç»˜åˆ¶å¤šæ¬¡
â”‚  â•‘ A â•‘  â•‘ B â•‘      â”‚  A(èƒŒæ™¯) -> B(ä¸­æ™¯) -> C(å‰æ™¯)
â”‚  â•šâ•â•â•â•  â•šâ•â•â•â•      â”‚  OverDraw = 3x
â”‚    â•”â•â•â•â•â•â•â•—        â”‚
â”‚    â•‘  C   â•‘        â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 OverDraw æ£€æµ‹

```csharp
// âœ… Frame Debugger æŸ¥çœ‹ OverDraw
// Window > Analysis > Frame Debugger
// é€‰æ‹© OverDraw æ¨¡å¼

// âœ… åˆ›å»º OverDraw å¯è§†åŒ– Shader
Shader "Custom/OverDraw" {
    SubShader {
        Tags { "Queue"="Transparent+1" }
        Pass {
            Blend One One
            ZWrite Off ZTest Always
            CGPROGRAM
            #pragma vertex vert
            #pragma fragment frag
            struct appdata { float4 vertex : POSITION; };
            struct v2f { float4 vertex : SV_POSITION; };
            v2f vert(appdata v) {
                v2f o; o.vertex = UnityObjectToClipPos(v.vertex);
                return o;
            }
            fixed4 frag(v2f i) : SV_Target {
                return fixed4(0.1, 0.1, 0.1, 0);
            }
            ENDCG
        }
    }
}
```

### 3.3 OverDraw ä¼˜åŒ–ç­–ç•¥

| ç­–ç•¥ | è¯´æ˜ | æ•ˆæœ |
|-----|------|------|
| **æ¸²æŸ“é¡ºåº** | ä¸é€æ˜ç‰©ä½“ä»å‰å‘å | å‡å°‘ Early-Z å‰”é™¤å¤±è´¥ |
| **å‰”é™¤èƒŒé¢** | å‰”é™¤ç›¸æœºçœ‹ä¸è§çš„èƒŒé¢ | å‡å°‘å¡«å……ç‡ |
| **é®æŒ¡å‰”é™¤** | ä¸æ¸²æŸ“è¢«é®æŒ¡ç‰©ä½“ | å¤§å¹…å‡å°‘ OverDraw |
| **é€æ˜åˆå¹¶** | åˆå¹¶é€æ˜ UI å…ƒç´  | å‡å°‘ UI OverDraw |

---

## å››ã€LOD (Level of Detail)

### 4.1 LOD åŸç†

```
è·ç¦» / LOD çº§åˆ«:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                         â”‚
    â”‚  Far LOD2 (ä½æ¨¡) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚                    30m             â”‚   â”‚
    â”‚  Mid LOD1 (ä¸­æ¨¡) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
    â”‚                 15m          â”‚       â”‚   â”‚
    â”‚  Near LOD0 (é«˜æ¨¡) â—„â”€â”€â”€â”€â”     â”‚       â”‚   â”‚
    â”‚                  5m    â”‚     â”‚       â”‚   â”‚
    â”‚                        â–¼     â–¼       â–¼   â”‚
    â”‚                      Camera           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 LOD Group ä½¿ç”¨

```csharp
// âœ… ä»£ç è®¾ç½® LOD
LODGroup lodGroup = gameObject.AddComponent<LODGroup>();

// åˆ›å»º LOD çº§åˆ«
LOD[] lods = new LOD[3];
lods[0] = new LOD(0.5f, new Renderer[] { highPolyRenderer });  // 50%
lods[1] = new LOD(0.2f, new Renderer[] { midPolyRenderer });   // 20%
lods[2] = new LOD(0.01f, new Renderer[] { lowPolyRenderer });  // 1%

lodGroup.SetLODs(lods);
lodGroup.RecalculateBounds();
```

### 4.3 LOD åˆ‡æ¢è·ç¦»å»ºè®®

| å¹³å° | LOD æ•°é‡ | åˆ‡æ¢è·ç¦» |
|-----|---------|---------|
| **PC/Console** | 3-4 çº§ | è¾ƒè¿œ |
| **Mobile High** | 3 çº§ | ä¸­ç­‰ |
| **Mobile Low** | 2-3 çº§ | è¾ƒè¿‘ |

---

## äº”ã€é®æŒ¡å‰”é™¤ (Occlusion Culling)

### 5.1 é®æŒ¡å‰”é™¤åŸç†

```
æ— é®æŒ¡å‰”é™¤:
    Camera
       â”‚
       â”œâ”€â”€> æ¸²æŸ“ A (å¯è§)
       â”œâ”€â”€> æ¸²æŸ“ B (è¢« A æŒ¡ä½ä½†ä»æ¸²æŸ“)
       â””â”€â”€> æ¸²æŸ“ C (è¢« A æŒ¡ä½ä½†ä»æ¸²æŸ“)

æœ‰é®æŒ¡å‰”é™¤:
    Camera
       â”‚
       â”œâ”€â”€> æ¸²æŸ“ A (å¯è§)
       â”œâ”€â”€> è·³è¿‡ B (è¢«é®æŒ¡)
       â””â”€â”€> è·³è¿‡ C (è¢«é®æŒ¡)
```

### 5.2 é®æŒ¡å‰”é™¤é…ç½®

```csharp
// âœ… å¯ç”¨é®æŒ¡å‰”é™¤
// Project Settings > Player > Occlusion Culling

// çƒ˜ç„™é®æŒ¡æ•°æ®:
// Window > Rendering > Occlusion Culling > Bake

// è¿è¡Œæ—¶æ§åˆ¶
GameObject.GetComponent<OcclusionPortal>().open = true;
```

### 5.3 Occlusion Portal

```csharp
// âœ… é—¨/çª—ç­‰åŠ¨æ€å¼€å£ä½¿ç”¨ Occlusion Portal
OcclusionPortal portal = gameObject.AddComponent<OcclusionPortal>();
portal.open = false;  // é—¨å…³é—­æ—¶é®æŒ¡ç”Ÿæ•ˆ
portal.open = true;   // é—¨å¼€å¯æ—¶é®æŒ¡å¤±æ•ˆ
```

---

## å…­ã€Shader ä¼˜åŒ–

### 6.1 ç€è‰²å™¨å¤æ‚åº¦ä¼˜åŒ–

```csharp
// âŒ å¤æ‚è®¡ç®—
fixed4 frag(v2f i) : SV_Target {
    fixed4 col = tex2D(_MainTex, i.uv);
    // å¤§é‡ sin/cos/pow ç­‰å¤æ‚è¿ç®—
    col.rgb *= sin(_Time.y * 10) * pow(col.r, 2.0);
    return col;
}

// âœ… ç®€åŒ–è®¡ç®—
fixed4 frag(v2f i) : SV_Target {
    fixed4 col = tex2D(_MainTex, i.uv);
    // ä½¿ç”¨æŸ¥è¡¨æˆ–é¢„è®¡ç®—
    col.rgb *= _ColorMultiplier.rgb;
    return col;
}
```

### 6.2 ç§»åŠ¨å¹³å° Shader æ³¨æ„äº‹é¡¹

| é—®é¢˜ | ä¼˜åŒ–æ–¹æ¡ˆ |
|-----|---------|
| **pow/exp/log** | ä½¿ç”¨æŸ¥æ‰¾è¡¨ |
| **sin/cos** | ä½¿ç”¨è¿‘ä¼¼å‡½æ•° |
| **çº¹ç†é‡‡æ ·** | ä½¿ç”¨ Mipmaps |
| **ç²¾åº¦** | mobile ä½¿ç”¨ half/fixed |
| **åˆ†æ”¯** | å°½é‡é¿å…åŠ¨æ€åˆ†æ”¯ |

### 6.3 ç²¾åº¦ä¼˜åŒ–

```hlsl
// âœ… ç§»åŠ¨å¹³å°ä½¿ç”¨ä½ç²¾åº¦
// Vertex Shader
float4 pos : POSITION;     // éœ€è¦é«˜ç²¾åº¦
half3 normal : NORMAL;     // æ³•çº¿ç”¨ half
float2 uv : TEXCOORD0;     // UV ç”¨ float

// Fragment Shader
fixed4 col : SV_Target;    // é¢œè‰²ç”¨ fixed
half3 viewDir : TEXCOORD0; // æ–¹å‘ç”¨ half
```

---

## ä¸ƒã€çº¹ç†ä¼˜åŒ–

### 7.1 çº¹ç†æ ¼å¼

| å¹³å° | æ¨èæ ¼å¼ | è¯´æ˜ |
|-----|---------|------|
| **iOS** | ASTC 4x4 / PVRTC | ç¡¬ä»¶æ”¯æŒ |
| **Android** | ETC2 / ASTC | å…¼å®¹æ€§è€ƒè™‘ |
| **PC** | DXT / BC7 | å‹ç¼©ç‡é«˜ |

### 7.2 çº¹ç†å°ºå¯¸

```csharp
// âœ… æœ€å¤§çº¹ç†å°ºå¯¸è®¾ç½®
PlayerSettings.SetTextureStreamingBudgetPerScene(512 * 1024 * 1024);

// Mipmap Streaming
TextureImporter importer = AssetImporter.GetAtPath(path) as TextureImporter;
importer.streamingMipmapsActive = true;
importer.streamingMipmapsAddAllCameras = true;
```

### 7.3 çº¹ç†å›¾é›†

```
å›¾é›†ä¼˜åŠ¿:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å•å¼ çº¹ç†            çº¹ç†å›¾é›†        â”‚
â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ A â”‚ â”‚ B â”‚ â”‚ C â”‚    â”‚ A B C â”‚   â”‚
â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜    â”‚ D E F â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”    â”‚ G H I â”‚   â”‚
â”‚  â”‚ D â”‚ â”‚ E â”‚ â”‚ F â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜                  â”‚
â”‚                                     â”‚
â”‚  6 DrawCalls      1 DrawCall        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…«ã€å…‰ç…§ä¼˜åŒ–

### 8.1 å®æ—¶å…‰ç…§ vs çƒ˜ç„™å…‰ç…§

| ç±»å‹ | æ€§èƒ½å¼€é”€ | è´¨é‡ | ç”¨é€” |
|-----|---------|------|------|
| **å®æ—¶ç‚¹å…‰** | é«˜ | é«˜ | åŠ¨æ€å…‰æº |
| **å®æ—¶èšå…‰ç¯** | å¾ˆé«˜ | é«˜ | æ‰‹ç”µç­’ç­‰ |
| **çƒ˜ç„™å…‰ç…§** | ä½ | é«˜ | é™æ€åœºæ™¯ |
| **Light Probes** | ä¸­ | ä¸­ | åŠ¨æ€ç‰©ä½“ |
| **LPPV** | ä¸­ | ä¸­ | å¤§åœºæ™¯åŠ¨æ€ç‰©ä½“ |

### 8.2 å…‰ç…§ä¼˜åŒ–ç­–ç•¥

```csharp
// âœ… è®¾ç½®å…‰æ¸²æŸ“æ¨¡å¼
Light light = GetComponent<Light>();
light.renderMode = LightRenderMode.ForcePixel;  // é‡è¦å…‰æº
light.renderMode = LightRenderMode.ForceVertex; // æ¬¡è¦å…‰æº
light.shadows = LightShadows.None;             // æ— é˜´å½±

// âœ… é™åˆ¶å®æ—¶å…‰æ•°é‡
// ç§»åŠ¨ç«¯å»ºè®®: 1-2 ä¸ªå®æ—¶å…‰
// PC å»ºè®®: 3-4 ä¸ªé‡è¦å®æ—¶å…‰
```

---

## ä¹ã€ç²’å­ç³»ç»Ÿä¼˜åŒ–

### 9.1 ç²’å­ä¼˜åŒ–ç­–ç•¥

| ä¼˜åŒ–é¡¹ | è¯´æ˜ |
|-------|------|
| **å‡å°‘ç²’å­æ•°** | ä½¿ç”¨æœ€å¤§ç²’å­æ•°é™åˆ¶ |
| **ä½¿ç”¨ Prewarm** | é¢„çƒ­é¿å…å¯åŠ¨å¼€é”€ |
| **ç¦ç”¨ä¸å¿…è¦çš„æ¨¡å—** | Collision / Trails ç­‰ |
| **ä½¿ç”¨ Sprite ç²’å­** | æ¯” Mesh ç²’å­å¿« |
| **é™ä½æ›´æ–°é¢‘ç‡** | ä½¿ç”¨ Fixed Timestep |

### 9.2 ç²’å­é…ç½®ç¤ºä¾‹

```csharp
// âœ… ä¼˜åŒ–ç²’å­ç³»ç»Ÿ
ParticleSystem ps = GetComponent<ParticleSystem>();

var main = ps.main;
main.maxParticles = 100;           // é™åˆ¶æœ€å¤§ç²’å­æ•°
main.prewarm = true;               // å¯ç”¨é¢„çƒ­
main.simulationSpace = ParticleSystemSimulationSpace.Local;  // ä½¿ç”¨å±€éƒ¨ç©ºé—´
main.scalingMode = ParticleSystemScalingMode.Local;

// ç¦ç”¨ç¢°æ’
var collision = ps.collision;
collision.enabled = false;

// é™ä½æ¸²æŸ“ä¼˜å…ˆçº§
var renderer = ps.GetComponent<ParticleSystemRenderer>();
renderer.renderMode = ParticleSystemRenderMode.Stretch;
renderer.alignment = ParticleSystemRenderSpace.View;
```

---

## åã€UI æ¸²æŸ“ä¼˜åŒ–

### 10.1 UGUI ä¼˜åŒ–è¦ç‚¹

| ä¼˜åŒ–é¡¹ | è¯´æ˜ |
|-------|------|
| **Canvas åˆ†å‰²** | ä¸åŒé¢‘ç‡æ›´æ–°çš„ UI åˆ†ç¦» |
| **éšè—ç©º Text** | ç©º Text ä¼šå ç”¨å¤§é‡å†…å­˜ |
| **é¿å… Layout** | å‡å°‘ Layout Group åµŒå¥— |
| **ä½¿ç”¨ Sprite Atlas** | åˆå¹¶ UI å›¾é›† |
| **ç¦ç”¨ Raycast Target** | ä¸éœ€è¦äº¤äº’çš„å…ƒç´  |

### 10.2 Canvas è®¾ç½®

```csharp
// âœ… UI Canvas ä¼˜åŒ–
Canvas canvas = GetComponent<Canvas>();

// é«˜é¢‘æ›´æ–° UI (è¡€æ¡ç­‰)
canvas.renderMode = RenderMode.ScreenSpaceOverlay;

// ä½é¢‘æ›´æ–° UI
canvas.renderMode = RenderMode.ScreenSpaceCamera;
canvas.worldCamera = uiCamera;

// é™æ€ UI
Canvas additionalCanvas = uiCanvas.gameObject.AddComponent<Canvas>();
additionalCanvas.overrideSorting = true;
additionalCanvas.sortingOrder = 100;
```

---

## åä¸€ã€ç§»åŠ¨å¹³å°ç‰¹æ®Šä¼˜åŒ–

### 11.1 ç§»åŠ¨ GPU ç‰¹æ€§

| GPU | ç‰¹ç‚¹ | ä¼˜åŒ–å»ºè®® |
|-----|------|---------|
| **Adreno** | TBDR æ¶æ„ | æ§åˆ¶ OverDraw |
| **Mali** | TBDR æ¶æ„ | å‡å°‘å¸¦å®½å‹åŠ› |
| **PowerVR** | TBDR æ¶æ„ | åˆ©ç”¨ HSR |
| **Tegra** | IMR æ¶æ„ | å…³æ³¨åƒç´ å¤æ‚åº¦ |

> ğŸ’¡ **TBDR** (Tile-Based Deferred Rendering)ï¼šç§»åŠ¨ GPU ä¸»æµæ¶æ„ï¼Œå¯¹ OverDraw æ•æ„Ÿã€‚

### 11.2 ç§»åŠ¨å¹³å°æ£€æŸ¥æ¸…å•

- [ ] ç¦ç”¨å®æ—¶é˜´å½±
- [ ] ä½¿ç”¨çƒ˜ç„™å…‰ç…§
- [ ] é™åˆ¶ç²’å­æ•°é‡
- [ ] ç®€åŒ– Shader å¤æ‚åº¦
- [ ] ä½¿ç”¨ ASTC çº¹ç†å‹ç¼©
- [ ] å¯ç”¨ Mipmap Streaming
- [ ] æ§åˆ¶æ¸²æŸ“åˆ†è¾¨ç‡
- [ ] ä½¿ç”¨ 16bit RenderTexture

---

## åäºŒã€ä¼˜åŒ–æ€»ç»“

### 12.1 å¿«é€Ÿæ£€æŸ¥æ¸…å•

| ç±»åˆ« | æ£€æŸ¥é¡¹ | ç›®æ ‡ |
|-----|-------|------|
| **DrawCall** | å‡å°‘ DC | <100 (Mobile) |
| **OverDraw** | æ§åˆ¶å¡«å……ç‡ | <2x å¹³å‡ |
| **Shader** | ç®€åŒ–å¤æ‚åº¦ | ç§»åŠ¨ç«¯ <50 æŒ‡ä»¤ |
| **çº¹ç†** | å‹ç¼©æ ¼å¼ | å…¨éƒ¨å‹ç¼© |
| **å…‰ç…§** | çƒ˜ç„™ä¸ºä¸» | <2 å®æ—¶å…‰ |
| **ç²’å­** | é™åˆ¶æ•°é‡ | <500 åŒå± |

### 12.2 æ€§èƒ½ç›®æ ‡

| å¹³å° | ç›®æ ‡å¸§ç‡ | GPU æ—¶é—´é¢„ç®— |
|-----|---------|-------------|
| **PC** | 60/144 FPS | <16ms / <6ms |
| **Console** | 30/60 FPS | <33ms / <16ms |
| **Mobile High** | 60 FPS | <16ms |
| **Mobile Mid** | 30 FPS | <33ms |
| **Mobile Low** | 30 FPS | <33ms |

---

## åä¸‰ã€å‚è€ƒèµ„æ–™

- [Unity - Optimizing Graphics Performance](https://docs.unity3d.com/Manual/MobileOptimizationPracticalGraphicsOptimizations.html)
- [Unity - Draw Call Batching](https://docs.unity3d.com/Manual/DrawCallBatching.html)
- [Unity - GPU Instancing](https://docs.unity3d.com/Manual/GPUInstancing.html)
- [Unity - Occlusion Culling](https://docs.unity3d.com/Manual/OcclusionCulling.html)

---

**è½¬è½½è¯·æ³¨æ˜æ¥æº**ï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºï¼Œä¹Ÿå¯ä»¥é‚®ä»¶è‡³ 1487842110@qq.com
