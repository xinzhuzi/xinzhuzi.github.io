---
title: "Unity UI ç³»åˆ—ç¬¬å››ç« ï¼šäº‹ä»¶ç³»ç»Ÿä¸äº¤äº’å®ç°"
date: 2020/05/08
categories: [æŠ€æœ¯æ–‡ç« , Unityå¼€å‘]
tags: [Unity, UGUI, EventSystem, äº‹ä»¶, äº¤äº’, UIäº‹ä»¶]
image: /images/unity-ui-series-chapter4-banner.jpg
---

# ğŸ¯ Unity UI ç³»åˆ—ç¬¬å››ç« ï¼šäº‹ä»¶ç³»ç»Ÿä¸äº¤äº’å®ç°

> ğŸ’¡ **äº‹ä»¶ç³»ç»Ÿçš„æ ¸å¿ƒ**ï¼š
> - ç‚¹å‡»äº‹ä»¶å¦‚ä½•ä¼ é€’ï¼ŸEventSystem æ€ä¹ˆå·¥ä½œï¼Ÿ
> - IPointerClickHandlerã€IDragHandler æ€ä¹ˆç”¨ï¼Ÿ
> - å¦‚ä½•å®ç°è‡ªå®šä¹‰çš„ UI äº¤äº’ï¼Ÿ
> - äº‹ä»¶ç³»ç»Ÿçš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼Ÿ
>
> **ç³»åˆ—ç¬¬å››ç« **ï¼Œæ·±å…¥è®²è§£ UGUI äº‹ä»¶ç³»ç»Ÿä¸äº¤äº’å®ç°ï¼

é®ç½©Mask

- Maskç»„ä»¶å¿…é¡»è¦ä¾èµ–ä¸€ä¸ªImageç»„ä»¶ï¼Œè£å‰ªåŒºåŸŸå°±æ˜¯Imageçš„å¤§å°,å­èŠ‚ç‚¹åœ¨Imageæ¸²æŸ“åŒºåŸŸæ‰ä¼šæ˜¾ç¤ºã€‚ä¸»è¦å¤„ç†ä¸è§„åˆ™å›¾å½¢é®ç½©æ•ˆæœ

- Mask+Image æ˜¯ 2 ä¸ª Batch,è¿™ 2 ä¸ª Batch æ˜¯ Mask å¤´ä¸ Mask å°¾.

- å¤šä¸ª Mask ç»„åˆ,æ²¡æœ‰å­èŠ‚ç‚¹,å¹¶ä¸”çº¿æ¡†æ²¡æœ‰é‡å ,ç›¸åŒçš„å›¾é›†å¯ä»¥åˆæ‰¹,åœ¨ç›¸åŒçš„ Depth ä¸Š,ç›¸åŒçš„å›¾é›†.

- Mask å­èŠ‚ç‚¹å¯ä»¥ä¸å¤–ç•Œçš„ Mask å­èŠ‚ç‚¹åˆæ‰¹,ä¸èƒ½ä¸å¤–ç•Œçš„ UI èŠ‚ç‚¹åˆæ‰¹.

æŠŠ Mask + Imageå½“æˆä¸€ä¸ªèŠ‚ç‚¹,ä½†æ˜¯ä¸ä¸æ™®é€šèŠ‚ç‚¹ä¸€æ ·.
Mask èŠ‚ç‚¹æ— æ³•å’Œæ²¡æœ‰ Maskçš„ Image èŠ‚ç‚¹åˆæ‰¹,
ä½†å¤šä¸ªMaskå†…çš„UIèŠ‚ç‚¹é—´å¦‚æœç¬¦åˆåˆæ‰¹æ¡ä»¶ï¼Œå¯ä»¥åˆæ‰¹(Mask èŠ‚ç‚¹åœ¨ç›¸åŒçš„ Hierarchy å±‚æ¬¡èŠ‚ç‚¹,æœ‰ç›¸åŒçš„å›¾é›†æ‰ä¼šåˆæ‰¹)
ä¸”å­èŠ‚ç‚¹ä¹Ÿä¼šåˆæ‰¹,ç›¸åŒMaskèŠ‚ç‚¹ç±»å‹ä¸‹çš„å­èŠ‚ç‚¹ä¹Ÿä¼šåˆæ‰¹.

- MaskåµŒå¥—ä¸èƒ½è¶…è¿‡ 9 å±‚, åœ¨æºç Mask.cs çš„ GetModifiedMaterial æ–¹æ³•ä¸­.

MaskåŸç†

- å¼•ç”¨æ–‡ç« :[https://zhuanlan.zhihu.com/p/339378916](https://zhuanlan.zhihu.com/p/339378916)

Mask åŸç†: Mask æ˜¯åˆ©ç”¨äº† GPU çš„æ¨¡æ¿ç¼“å†²æ¥å®ç°çš„,åœ¨Mask.csçš„ GetModifiedMaterialæ–¹æ³•ä¸­ StencilMaterial.Add(xxx)æ˜¯æœ€æ ¸å¿ƒçš„å†…å®¹
å®ƒçš„ä½œç”¨æ˜¯ä¸º Mask å¯¹è±¡ç”Ÿæˆä¸€ä¸ªç‰¹æ®Šçš„æè´¨,è¿™ä¸ªæè´¨ä¼šå°† StencilBuffer çš„å€¼ç½®ä¸º 1
åœ¨å…¶ä»– MaskableGraphic ç»„ä»¶ä¸­,ä¹Ÿæœ‰ç›¸ä¼¼çš„ä»£ç ,ä½œç”¨æ˜¯ä¸ºMaskableGraphicç”Ÿæˆä¸€ä¸ªç‰¹æ®Šçš„æè´¨,
è¿™ä¸ªæè´¨åœ¨æ¸²æŸ“æ—¶ä¼šå–å‡ºStencilBufferçš„å€¼,åˆ¤æ–­æ˜¯å¦ä¸º 1,å¦‚æœæ˜¯æ‰æ¸²æŸ“.

- èƒ½ä¸ç”¨å°±ä¸ç”¨,åº”ç”¨åœºæ™¯ä¸€èˆ¬æ˜¯åœ¨ç‰¹åˆ«èŠ±å“¨çš„ç•Œé¢ä¸Šé¢.ScrollView ä¸€èˆ¬é‡‡ç”¨çš„æ˜¯ RectMask2D æ–¹æ¡ˆ

![Maskå¤´å°¾](/2021/08/12/UnityUI/UGUI&TMP%20%E7%B3%BB%E5%88%97%E7%AC%AC%E5%9B%9B%E7%AB%A0/Mask%E5%A4%B4%E5%B0%BE.png)

RectMask2D

- RectMask2Dåªæœ‰ 2 ä¸ªç»„ä»¶,ä¸€ä¸ªæ˜¯ RectTransform,ä¸€ä¸ªRectMask2D,ä»¥ RT ä¸ºè£å‰ªåŒºåŸŸ,å­èŠ‚ç‚¹åœ¨ RT åŒºåŸŸå†…æ˜¾ç¤º.åªèƒ½åšçŸ©å½¢é®ç½©.

- çœ‹å®˜æ–¹æ‰‹å†Œ[https://docs.unity3d.com/cn/current/Manual/script-Mask.html](https://docs.unity3d.com/cn/current/Manual/script-Mask.html)

- å¦‚æœåªç”¨å›ºå®šçŸ©å½¢é®ç½©,ä¸éœ€è¦ç‰¹æ®Šå½¢çŠ¶é®ç½©çš„æƒ…å†µä¸‹,å¯ä»¥ä¼˜å…ˆä½¿ç”¨ RectMask2D,å¦‚æœå½“å‰è®¾è®¡åªæœ‰ä¸€ä¸ªé®ç½©,é‚£ä¹ˆä¹Ÿç”¨RectMask2D.ä½¿ç”¨ Frame Debugger å¯¹æ¯”DrawMeshå³å¯.

- RectMask2DèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­©å­éƒ½ä¸èƒ½ä¸å¤–ç•ŒUIèŠ‚ç‚¹åˆæ‰¹,ä¸”å¤šä¸ªRectMask2Dä¹‹é—´ä¸èƒ½åˆæ‰¹ã€‚RectMask2DèŠ‚ç‚¹ä¸å¤–éƒ¨UIèŠ‚ç‚¹ä¸Šçš„ image æ˜¯å¯ä»¥åˆæ‰¹çš„.

è®¡ç®—depthçš„æ—¶å€™ï¼Œæ‰€æœ‰çš„RectMask2Déƒ½æŒ‰ä¸€èˆ¬UIèŠ‚ç‚¹çœ‹å¾…ï¼Œåªæ˜¯å®ƒæ²¡æœ‰CanvasRendererç»„ä»¶,å¹¶ä¸”ä¼šæ‰“æ–­åˆæ‰¹.
åœ¨æºç  RectMask2D.cs çš„ PerformClipping æ–¹æ³•ä¸­,ä»–å¹¶æ²¡æœ‰æ›¿æ¢æè´¨çš„è¿‡ç¨‹ï¼Œæ²¡æœ‰ç”¨åˆ°æ¨¡æ¿ç¼“å†²çš„å®ç°æ–¹å¼ï¼Œè€Œæ˜¯é€šè¿‡äº†canvasRenderé‡Œé¢è¿›è¡Œäº†ClipRectçš„å‰”é™¤

å¯ä»¥èŠ‚çœ DrawCall ä¸ Overdraw,è‡ªèº«ä¸å¢åŠ  DC,ä¼šå¢åŠ  Cull(è£å‰ª) å¼€é”€(SendWill),æŒç»­å¼€é”€è¾ƒä½,æ‹–åŠ¨æ—¶å¼€é”€è¾ƒé«˜.
å¦‚æœæ»šåŠ¨çš„æ—¶å€™æ¯”è¾ƒå¡é¡¿,éœ€è¦å°è¯•ä½¿ç”¨ mask æ¥æ›¿æ¢æµ‹è¯•ä¸€ä¸‹.æƒè¡¡ä¸€ä¸‹ 2 ä¸ªç»„ä»¶,å“ªä¸ªå¯ä»¥æ¥å—.

![RectMask2D](/2021/08/12/UnityUI/UGUI&TMP%20%E7%B3%BB%E5%88%97%E7%AC%AC%E5%9B%9B%E7%AB%A0/RectMask2D.png)

é€šç”¨æ€§æ€»ç»“

å½“ä¸€ä¸ªç•Œé¢åªæœ‰ä¸€ä¸ªmaskï¼Œé‚£ä¹ˆï¼ŒRectMask2D ä¼˜äº Mask
å½“éœ€è¦ä¸¤ä¸ªé®ç½©ï¼Œå¹¶ä¸” Mask å¯ä»¥è¿›è¡Œåˆæ‰¹ï¼Œä¸¤è€…ç›¸å·®ä¸å¤§ã€‚
å½“å¤§äºä¸¤ä¸ªmaskï¼Œé‚£ä¹ˆï¼ŒMask ä¼˜äº RectMask2Dã€‚
æœ€ç»ˆè¿˜æ˜¯è¦çœ‹ Frame Debugger ä¸Šé¢çš„ DrawMesh å¤šå°‘æ¥åˆ¤æ–­ç”¨å“ªä¸ªç»„ä»¶æ¯”è¾ƒå¥½.

å¼•ç”¨æ–‡ç« 

- [https://www.cnblogs.com/moran-amos/p/13883818.html](https://www.cnblogs.com/moran-amos/p/13883818.html)

- [https://www.pianshen.com/article/21261176829/](https://www.pianshen.com/article/21261176829/)

- [https://www.pianshen.com/article/21261176829/](https://www.pianshen.com/article/21261176829/)

- [https://docs.unity3d.com/cn/current/Manual/script-Mask.html](https://docs.unity3d.com/cn/current/Manual/script-Mask.html)

      
        è½¬è½½è¯·æ³¨æ˜æ¥æºï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºï¼Œä¹Ÿå¯ä»¥é‚®ä»¶è‡³ 1487842110@qq.com
