---
title: "Unity Gizmos å®Œå…¨æŒ‡å—ï¼šè®©è°ƒè¯•å¯è§†åŒ–å¦‚æ­¤ç®€å•"
date: 2020/05/08
categories: [æŠ€æœ¯æ–‡ç« , Unityå¼€å‘]
tags: [Unity, Gizmos, OnDrawGizmos, ç¼–è¾‘å™¨æ‰©å±•, è°ƒè¯•å·¥å…·, åœºæ™¯è§†å›¾]
image: /images/unity-gizmos-banner.jpg
---

# ğŸ” Unity Gizmos å®Œå…¨æŒ‡å—ï¼šè®©è°ƒè¯•å¯è§†åŒ–å¦‚æ­¤ç®€å•

> ğŸ’¡ **å¯è§†åŒ–è°ƒè¯•çš„ä»·å€¼**ï¼š
> - è°ƒè¯•æ—¶æƒ³çœ‹åˆ°æ”»å‡»èŒƒå›´ã€è§†é‡è§’åº¦ï¼Œä¸çŸ¥é“æ€ä¹ˆç”»ï¼Ÿ
> - Gizmos å’Œ Handles æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè¯¥æ€ä¹ˆé€‰ï¼Ÿ
> - å¦‚ä½•è®©è°ƒè¯•ä¿¡æ¯æ—¢ç›´è§‚åˆä¸å½±å“æ€§èƒ½ï¼Ÿ
> - æƒ³åœ¨ Scene è§†å›¾ä¸­çœ‹åˆ°æ›´å¤šå¯è§†åŒ–ä¿¡æ¯ï¼Ÿ
>
> **è¿™ç¯‡æ–‡ç« ï¼** å°†ç³»ç»Ÿè®²è§£ Unity Gizmos æœºåˆ¶ï¼Œè®©ä½ çš„è°ƒè¯•å·¥ä½œäº‹åŠåŠŸå€ï¼

## ä¸€ã€Gizmos æ¦‚è¿°

`Gizmos` ç±»æä¾›äº†ä¸€å¥—åœ¨ Scene è§†å›¾ä¸­ç»˜åˆ¶è°ƒè¯•å¯è§†åŒ–å…ƒç´ çš„èƒ½åŠ›ï¼Œä¸ Handles ä¸åŒï¼ŒGizmos ç»˜åˆ¶çš„æ˜¯**ä¸å¯äº¤äº’**çš„çº¯æ˜¾ç¤ºå…ƒç´ ã€‚

### 1.1 Gizmos ä¸ Handles å¯¹æ¯”

| ç‰¹æ€§ | Gizmos | Handles |
|------|--------|---------|
| **ä½œç”¨** | çº¯å¯è§†åŒ–æ˜¾ç¤º | å¯äº¤äº’çš„ç¼–è¾‘æ‰‹æŸ„ |
| **ä½ç½®** | `OnDrawGizmos()` | `OnSceneGUI()` |
| **äº¤äº’** | âŒ ä¸å¯äº¤äº’ | âœ… å¯æ‹–åŠ¨ã€ç‚¹å‡» |
| **è¿è¡ŒçŠ¶æ€** | âœ… è¿è¡Œæ—¶æ˜¾ç¤º | âŒ ä»…ç¼–è¾‘å™¨ |
| **å…¸å‹ç”¨é€”** | è°ƒè¯•è¾…åŠ©çº¿ã€èŒƒå›´æ˜¾ç¤º | è·¯å¾„ç¼–è¾‘ã€å‚æ•°è°ƒèŠ‚ |

### 1.2 ä½¿ç”¨åœºæ™¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Scene åœºæ™¯è§†å›¾                       â”‚
â”‚                                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â”‚            Gizmos å¯è§†åŒ–å…ƒç´                â”‚       â”‚
â”‚    â”‚                                           â”‚       â”‚
â”‚    â”‚    â— â† DrawWireSphere (èŒƒå›´æ£€æµ‹)         â”‚       â”‚
â”‚    â”‚    â”‚                                       â”‚       â”‚
â”‚    â”‚    â”€â”€â”€ â† DrawLine (è¾…åŠ©çº¿)               â”‚       â”‚
â”‚    â”‚    â”‚                                       â”‚       â”‚
â”‚    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â† DrawWireCube (ç¢°æ’ç›’)   â”‚       â”‚
â”‚    â”‚    â”‚  ICON   â”‚ â† DrawIcon (ä½ç½®æ ‡è®°)     â”‚       â”‚
â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                         â”‚
â”‚  æ‰€æœ‰å…ƒç´ ä»…ä¾›è°ƒè¯•æŸ¥çœ‹ï¼Œä¸å¯äº¤äº’æ“ä½œ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| åº”ç”¨åœºæ™¯ | æè¿° |
|---------|------|
| ğŸ¯ **èŒƒå›´å¯è§†åŒ–** | æ˜¾ç¤ºè§¦å‘åŒºåŸŸã€æ”»å‡»èŒƒå›´ã€æ£€æµ‹èŒƒå›´ |
| ğŸ“ **è¾…åŠ©çº¿** | ç»˜åˆ¶å°„çº¿ã€æ–¹å‘ã€è¿æ¥çº¿ |
| ğŸ“¦ **ç¢°æ’ç›’** | æ˜¾ç¤ºå®é™…çš„ç‰©ç†ç¢°æ’ä½“ç§¯ |
| ğŸ” **è°ƒè¯•ä¿¡æ¯** | æ˜¾ç¤ºè·¯å¾„ã€è½¨è¿¹ã€é¢„æµ‹ä½ç½® |
| ğŸ“ **ä½ç½®æ ‡è®°** | ä½¿ç”¨ Icon æ ‡è®°é‡è¦ä½ç½® |

---

## äºŒã€ç»˜åˆ¶ç”Ÿå‘½å‘¨æœŸ

### 2.1 OnDrawGizmos ä¸ OnDrawGizmosSelected

| æ–¹æ³• | è°ƒç”¨æ—¶æœº | å…¸å‹ç”¨é€” |
|------|---------|---------|
| `OnDrawGizmos()` | **å§‹ç»ˆ**è°ƒç”¨ | æŒç»­æ˜¾ç¤ºçš„è°ƒè¯•ä¿¡æ¯ |
| `OnDrawGizmosSelected()` | **ä»…é€‰ä¸­å¯¹è±¡**æ—¶è°ƒç”¨ | é€‰ä¸­æ—¶çš„é¢å¤–ä¿¡æ¯ |

### 2.2 åŸºæœ¬ç»“æ„

```csharp
using UnityEngine;

public class GizmosExample : MonoBehaviour
{
    // å§‹ç»ˆç»˜åˆ¶çš„ Gizmos
    private void OnDrawGizmos()
    {
        // è®¾ç½®ç»˜åˆ¶é¢œè‰²
        Gizmos.color = Color.yellow;

        // ç»˜åˆ¶å„ç§å½¢çŠ¶...
    }

    // ä»…é€‰ä¸­å¯¹è±¡æ—¶ç»˜åˆ¶
    private void OnDrawGizmosSelected()
    {
        // é€‰ä¸­æ—¶æ‰æ˜¾ç¤ºçš„é¢å¤–ä¿¡æ¯...
    }
}
```

### 2.3 æ‰§è¡Œæ—¶æœº

```
Unity ç¼–è¾‘å™¨å¾ªç¯
â”‚
â”œâ”€ Update()
â”œâ”€ LateUpdate()
â”œâ”€ OnDrawGizmos()        â† æ¯å¸§ç»˜åˆ¶ï¼ˆæ‰€æœ‰å¯¹è±¡ï¼‰
â”œâ”€ OnDrawGizmosSelected() â† æ¯å¸§ç»˜åˆ¶ï¼ˆä»…é€‰ä¸­å¯¹è±¡ï¼‰
â””â”€ GUI()
```

> âš ï¸ **æ³¨æ„**ï¼šGizmos åªåœ¨ Scene è§†å›¾ä¸­æ˜¾ç¤ºï¼ŒGame è§†å›¾ä¸­**ä¸æ˜¾ç¤º**ï¼ˆé™¤éå¼€å¯ Gizmos æ˜¾ç¤ºï¼‰ã€‚

---

## ä¸‰ã€åŸºæœ¬å½¢çŠ¶ç»˜åˆ¶

### 3.1 çº¿æ¡†å½¢çŠ¶ï¼ˆWireï¼‰

| æ–¹æ³• | æè¿° | å‚æ•° |
|------|------|------|
| `Gizmos.DrawWireSphere()` | çº¿æ¡†çƒä½“ | `center, radius` |
| `Gizmos.DrawWireCube()` | çº¿æ¡†ç«‹æ–¹ä½“ | `center, size` |
| `Gizmos.DrawWireCapsule()` | çº¿æ¡†èƒ¶å›Šä½“ | `point, radius, height` |

```csharp
private void OnDrawGizmos()
{
    // ç»˜åˆ¶é»„è‰²çº¿æ¡†çƒä½“
    Gizmos.color = Color.yellow;
    Gizmos.DrawWireSphere(transform.position, 2f);

    // ç»˜åˆ¶é’è‰²çº¿æ¡†ç«‹æ–¹ä½“
    Gizmos.color = Color.cyan;
    Gizmos.DrawWireCube(transform.position + Vector3.right * 5, Vector3.one * 2);
}
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Wire Shapes                â”‚
â”‚                                    â”‚
â”‚         â•”â•â•â•â•â•â•â•â•â•â•—                â”‚
â”‚         â•‘         â•‘  â† WireCube   â”‚
â”‚         â•‘         â•‘                â”‚
â”‚         â•šâ•â•â•â•â•â•â•â•â•â•                â”‚
â”‚                                    â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚        â•±           â•²               â”‚
â”‚       â”‚  â—‹ â— â—‹    â”‚  â† WireSphere â”‚
â”‚        â•²           â•±               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å®å¿ƒå½¢çŠ¶ï¼ˆSolidï¼‰

| æ–¹æ³• | æè¿° | å‚æ•° |
|------|------|------|
| `Gizmos.DrawSphere()` | å®å¿ƒçƒä½“ | `center, radius` |
| `Gizmos.DrawCube()` | å®å¿ƒç«‹æ–¹ä½“ | `center, size` |
| `Gizmos.DrawMesh()` | ç»˜åˆ¶ç½‘æ ¼ | `mesh, position, rotation` |

```csharp
private void OnDrawGizmos()
{
    // ç»˜åˆ¶åŠé€æ˜çº¢è‰²çƒä½“
    Gizmos.color = new Color(1, 0, 0, 0.5f);
    Gizmos.DrawSphere(transform.position, 1f);

    // ç»˜åˆ¶åŠé€æ˜ç»¿è‰²ç«‹æ–¹ä½“
    Gizmos.color = new Color(0, 1, 0, 0.5f);
    Gizmos.DrawCube(transform.position + Vector3.left * 3, Vector3.one);
}
```

### 3.3 çº¿æ¡ç»˜åˆ¶

| æ–¹æ³• | æè¿° | å‚æ•° |
|------|------|------|
| `Gizmos.DrawLine()` | ç»˜åˆ¶çº¿æ®µ | `start, end` |
| `Gizmos.DrawRay()` | ç»˜åˆ¶å°„çº¿ | `origin, direction` |

```csharp
private void OnDrawGizmos()
{
    // ç»˜åˆ¶çº¿æ®µ
    Gizmos.color = Color.white;
    Gizmos.DrawLine(transform.position, transform.position + transform.forward * 5);

    // ç»˜åˆ¶å°„çº¿
    Gizmos.color = Color.red;
    Gizmos.DrawRay(transform.position, transform.right * 3);
}
```

---

## å››ã€å¸¸ç”¨ç»˜åˆ¶æ–¹æ³•

### 4.1 å®Œæ•´æ–¹æ³•è¡¨

| æ–¹æ³• | æè¿° | è¿”å›å€¼ |
|------|------|--------|
| **åŸºç¡€å½¢çŠ¶** |||
| `DrawWireSphere()` | çº¿æ¡†çƒä½“ | - |
| `DrawSphere()` | å®å¿ƒçƒä½“ | - |
| `DrawWireCube()` | çº¿æ¡†ç«‹æ–¹ä½“ | - |
| `DrawCube()` | å®å¿ƒç«‹æ–¹ä½“ | - |
| `DrawWireCapsule()` | çº¿æ¡†èƒ¶å›Šä½“ | - |
| **çº¿æ¡ç›¸å…³** |||
| `DrawLine()` | çº¿æ®µ | - |
| `DrawRay()` | å°„çº¿ | - |
| `DrawFrustum()` | è§†é”¥ä½“ | - |
| **å…¶ä»–** |||
| `DrawIcon()` | å›¾æ ‡ | - |
| `DrawWireDisc()` | çº¿æ¡†åœ† | - |
| `DrawGUITexture()` | GUI çº¹ç† | - |

### 4.2 è§†é”¥ä½“ç»˜åˆ¶

```csharp
// æ‘„åƒæœºè§†é”¥ä½“å¯è§†åŒ–
private void OnDrawGizmosSelected()
{
    Camera camera = GetComponent<Camera>();
    if (camera == null) return;

    Gizmos.matrix = transform.localToWorldMatrix;
    Gizmos.DrawFrustum(Vector3.zero, camera.fieldOfView, camera.farClipPlane, camera.nearClipPlane, camera.aspect);
}
```

### 4.3 åœ†å½¢ç»˜åˆ¶

```csharp
private void OnDrawGizmos()
{
    // ç»˜åˆ¶æ°´å¹³åœ†å½¢
    Gizmos.color = Color.yellow;
    Gizmos.DrawWireSphere(transform.position, 3f);

    // æ›´ç²¾ç¡®çš„åœ†å½¢ï¼ˆé€šè¿‡çŸ©é˜µå˜æ¢ï¼‰
    Gizmos.matrix = Matrix4x4.TRS(transform.position, Quaternion.Euler(90, 0, 0), Vector3.one);
    Gizmos.DrawWireSphere(Vector3.zero, 3f);
}
```

---

## äº”ã€é¢œè‰²ä¸çŸ©é˜µ

### 5.1 è®¾ç½®é¢œè‰²

```csharp
private void OnDrawGizmos()
{
    // è®¾ç½®çº¯è‰²
    Gizmos.color = Color.red;
    Gizmos.DrawWireSphere(transform.position, 1f);

    // è®¾ç½®å¸¦é€æ˜åº¦çš„é¢œè‰²
    Gizmos.color = new Color(1, 0, 0, 0.3f); // 30% ä¸é€æ˜åº¦
    Gizmos.DrawSphere(transform.position + Vector3.right * 2, 1f);

    // é‡ç½®ä¸ºé»˜è®¤é¢œè‰²
    Gizmos.color = Color.white;
}
```

### 5.2 ä½¿ç”¨çŸ©é˜µå˜æ¢

```csharp
private void OnDrawGizmos()
{
    // ä¿å­˜å½“å‰çŸ©é˜µ
    Matrix4x4 originalMatrix = Gizmos.matrix;

    // åº”ç”¨è‡ªå®šä¹‰å˜æ¢
    Gizmos.matrix = transform.localToWorldMatrix;

    // åœ¨å±€éƒ¨ç©ºé—´ä¸­ç»˜åˆ¶
    Gizmos.color = Color.cyan;
    Gizmos.DrawWireCube(Vector3.zero, Vector3.one); // åœ¨ç‰©ä½“å±€éƒ¨åæ ‡ç³»åŸç‚¹ç»˜åˆ¶

    // æ¢å¤åŸå§‹çŸ©é˜µ
    Gizmos.matrix = originalMatrix;
}
```

---

## å…­ã€å›¾æ ‡ç»˜åˆ¶

### 6.1 DrawIcon åŸºæœ¬ç”¨æ³•

```csharp
private void OnDrawGizmos()
{
    // åœ¨ç‰©ä½“ä½ç½®ç»˜åˆ¶å›¾æ ‡
    // å‚æ•°ï¼šä½ç½®, å›¾æ ‡åç§°, æ˜¯å¦å…è®¸ç¼©æ”¾
    Gizmos.DrawIcon(transform.position, "enemy_icon.png", true);
}
```

### 6.2 å›¾æ ‡èµ„æºè®¾ç½®

1. åœ¨ `Assets/Gizmos` æ–‡ä»¶å¤¹ä¸­æ”¾ç½®å›¾æ ‡æ–‡ä»¶
2. å›¾æ ‡æ–‡ä»¶æ”¯æŒï¼š`.png`, `.jpg`, `.gif`
3. å¯ä»¥åœ¨ Gizmos çª—å£è®¾ç½®å›¾æ ‡å¤§å°

### 6.3 å®Œæ•´å›¾æ ‡ç¤ºä¾‹

```csharp
public class GizmosIconExample : MonoBehaviour
{
    public enum ObjectType
    {
        Enemy,
        Player,
        Pickup,
        Waypoint
    }

    public ObjectType type = ObjectType.Enemy;

    private void OnDrawGizmos()
    {
        string iconName = type.ToString().ToLower() + "_icon";
        Gizmos.DrawIcon(transform.position + Vector3.up * 2, iconName, true);
    }
}
```

---

## ä¸ƒã€å®Œæ•´ç¤ºä¾‹ï¼šAI æ„ŸçŸ¥èŒƒå›´å¯è§†åŒ–

```csharp
using UnityEngine;

/// <summary>
/// AI æ„ŸçŸ¥ç³»ç»Ÿ - å¯è§†åŒ–æ£€æµ‹èŒƒå›´
/// </summary>
public class AIPerception : MonoBehaviour
{
    [Header("æ„ŸçŸ¥è®¾ç½®")]
    [Tooltip("è§†é‡è§’åº¦ï¼ˆåº¦ï¼‰")]
    [Range(0, 360)]
    public float viewAngle = 90f;

    [Tooltip("è§†é‡è·ç¦»")]
    public float viewDistance = 10f;

    [Tooltip("å¬è§‰èŒƒå›´")]
    public float hearDistance = 5f;

    [Header("æ£€æµ‹å±‚çº§")]
    public LayerMask targetMask;

    [Header("å¯è§†åŒ–é¢œè‰²")]
    public Color viewColor = new Color(1, 0.5f, 0, 0.2f); // åŠé€æ˜æ©™è‰²
    public Color hearColor = new Color(0, 1, 0, 0.1f);    // åŠé€æ˜ç»¿è‰²

    // ç§æœ‰å˜é‡ç”¨äºè®¡ç®—
    private Vector3[] viewPoints;
    private int viewPointCount = 20;

    private void OnDrawGizmos()
    {
        // ç»˜åˆ¶å¬è§‰èŒƒå›´ï¼ˆåœ†å½¢ï¼‰
        Gizmos.color = hearColor;
        Gizmos.DrawWireSphere(transform.position, hearDistance);

        // ç»˜åˆ¶å‰æ–¹å‘å°„çº¿
        Gizmos.color = Color.yellow;
        Gizmos.DrawRay(transform.position, transform.forward * 2);
    }

    private void OnDrawGizmosSelected()
    {
        // é€‰ä¸­æ—¶æ˜¾ç¤ºè¯¦ç»†çš„å¯è§†åŒ–

        // 1. ç»˜åˆ¶è§†é‡æ‰‡å½¢
        DrawViewField();

        // 2. ç»˜åˆ¶å¬è§‰èŒƒå›´
        Gizmos.color = hearColor;
        Gizmos.DrawSphere(transform.position, hearDistance);

        // 3. æ˜¾ç¤ºè·ç¦»æ ‡æ³¨
        UnityEditor.Handles.Label(
            transform.position + transform.forward * viewDistance,
            $"<color=yellow>è§†é‡: {viewDistance}m</color>"
        );
    }

    private void DrawViewField()
    {
        // è®¡ç®—è§†é‡è¾¹ç•Œç‚¹
        Vector3 leftDir = DirFromAngle(-viewAngle / 2, false);
        Vector3 rightDir = DirFromAngle(viewAngle / 2, false);

        // ç»˜åˆ¶è§†é‡è¾¹ç•Œçº¿
        Gizmos.color = Color.red;
        Gizmos.DrawRay(transform.position, leftDir * viewDistance);
        Gizmos.DrawRay(transform.position, rightDir * viewDistance);

        // ç»˜åˆ¶è§†é‡æ‰‡å½¢åŒºåŸŸ
        DrawViewSector();
    }

    private void DrawViewSector()
    {
        // ä½¿ç”¨åŠé€æ˜é¢œè‰²å¡«å……æ‰‡å½¢
        Gizmos.color = viewColor;

        // è®¡ç®—æ‰‡å½¢çš„æ‰€æœ‰ç‚¹
        if (viewPoints == null || viewPoints.Length != viewPointCount + 2)
        {
            viewPoints = new Vector3[viewPointCount + 2];
        }

        // èµ·å§‹ç‚¹ï¼ˆç‰©ä½“ä½ç½®ï¼‰
        viewPoints[0] = transform.position;

        // è®¡ç®—æ‰‡å½¢å¼§çº¿ä¸Šçš„ç‚¹
        float stepAngle = viewAngle / viewPointCount;
        for (int i = 0; i <= viewPointCount; i++)
        {
            float angle = -viewAngle / 2 + stepAngle * i;
            Vector3 dir = DirFromAngle(angle, false);
            viewPoints[i + 1] = transform.position + dir * viewDistance;
        }

        // ç»˜åˆ¶è¿æ¥çº¿
        for (int i = 0; i < viewPoints.Length - 1; i++)
        {
            Gizmos.DrawLine(viewPoints[i], viewPoints[i + 1]);
        }
    }

    private Vector3 DirFromAngle(float angleInDegrees, bool angleIsGlobal)
    {
        if (!angleIsGlobal)
        {
            angleInDegrees += transform.eulerAngles.y;
        }
        return new Vector3(Mathf.Sin(angleInDegrees * Mathf.Deg2Rad), 0, Mathf.Cos(angleInDegrees * Mathf.Deg2Rad));
    }

    // è¿è¡Œæ—¶çš„æ£€æµ‹é€»è¾‘
    public Transform[] GetVisibleTargets()
    {
        Collider[] targetsInViewRadius = Physics.OverlapSphere(transform.position, viewDistance, targetMask);
        List<Transform> visibleTargets = new List<Transform>();

        foreach (Collider target in targetsInViewRadius)
        {
            Transform targetTransform = target.transform;
            Vector3 dirToTarget = (targetTransform.position - transform.position).normalized;

            if (Vector3.Angle(transform.forward, dirToTarget) < viewAngle / 2)
            {
                float distanceToTarget = Vector3.Distance(transform.position, targetTransform.position);

                if (!Physics.Linecast(transform.position, targetTransform.position, ~targetMask))
                {
                    visibleTargets.Add(targetTransform);
                }
            }
        }

        return visibleTargets.ToArray();
    }
}
```

### æ•ˆæœå±•ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Scene åœºæ™¯è§†å›¾                       â”‚
â”‚                                                         â”‚
â”‚                    AI æ„ŸçŸ¥èŒƒå›´                         â”‚
â”‚                                                         â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚            â•±                         â•²                 â”‚
â”‚          â•±    â† è§†é‡æ‰‡å½¢åŒºåŸŸ â†’       â•²                â”‚
â”‚        â•±                               â•²               â”‚
â”‚      â”‚  â— â† å¬è§‰èŒƒå›´ (åœ†å½¢)             â”‚              â”‚
â”‚        â•²                               â•±               â”‚
â”‚          â•²  â–² (æœå‘)                   â•±                 â”‚
â”‚            â•²                         â•±                 â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                         â”‚
â”‚  â”€â”€ = è§†é‡è¾¹ç•Œçº¿                                       â”‚
â”‚  â— = å¬è§‰èŒƒå›´åœ†å½¢                                       â”‚
â”‚  â–² = AI æœå‘                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…«ã€å®Œæ•´ç¤ºä¾‹ï¼šè·¯å¾„ç‚¹å¯è§†åŒ–

```csharp
using UnityEngine;

/// <summary>
/// è·¯å¾„ç‚¹ç»„ä»¶ - å¯è§†åŒ–è·¯å¾„è¿æ¥
/// </summary>
public class Waypoint : MonoBehaviour
{
    [Header("è·¯å¾„è®¾ç½®")]
    public Waypoint nextWaypoint;
    public Color pathColor = Color.cyan;
    public float sphereSize = 0.3f;

    private void OnDrawGizmos()
    {
        // ç»˜åˆ¶è‡ªèº«ä½ç½®æ ‡è®°
        Gizmos.color = Color.yellow;
        Gizmos.DrawWireSphere(transform.position, sphereSize);

        // ç»˜åˆ¶åˆ°ä¸‹ä¸€ä¸ªè·¯å¾„ç‚¹çš„è¿æ¥çº¿
        if (nextWaypoint != null)
        {
            Gizmos.color = pathColor;
            Gizmos.DrawLine(transform.position, nextWaypoint.transform.position);

            // ç»˜åˆ¶ç®­å¤´æ–¹å‘
            Vector3 direction = (nextWaypoint.transform.position - transform.position).normalized;
            Vector3 midPoint = (transform.position + nextWaypoint.transform.position) * 0.5f;
            Gizmos.DrawWireSphere(midPoint, sphereSize * 0.5f);
        }
    }

    private void OnDrawGizmosSelected()
    {
        // é€‰ä¸­æ—¶æ˜¾ç¤ºæ›´å¤šä¿¡æ¯
        Gizmos.color = Color.green;
        Gizmos.DrawSphere(transform.position, sphereSize * 1.5f);

        // æ˜¾ç¤ºåºå·æ ‡ç­¾
        UnityEditor.Handles.Label(
            transform.position + Vector3.up * 0.5f,
            $"<color=yellow>{gameObject.name}</color>"
        );

        // æ˜¾ç¤ºè¿æ¥è·ç¦»
        if (nextWaypoint != null)
        {
            float distance = Vector3.Distance(transform.position, nextWaypoint.transform.position);
            Vector3 midPoint = (transform.position + nextWaypoint.transform.position) * 0.5f;
            UnityEditor.Handles.Label(
                midPoint + Vector3.up * 0.5f,
                $"<color=cyan>{distance:F1}m</color>"
            );
        }
    }
}

/// <summary>
/// è·¯å¾„ç®¡ç†å™¨ - æ˜¾ç¤ºå®Œæ•´è·¯å¾„
/// </summary>
public class PathManager : MonoBehaviour
{
    public Waypoint[] waypoints;

    private void OnDrawGizmos()
    {
        if (waypoints == null || waypoints.Length == 0)
            return;

        // ç»˜åˆ¶å®Œæ•´è·¯å¾„
        Gizmos.color = Color.cyan;
        for (int i = 0; i < waypoints.Length - 1; i++)
        {
            if (waypoints[i] != null && waypoints[i + 1] != null)
            {
                Gizmos.DrawLine(waypoints[i].transform.position, waypoints[i + 1].transform.position);
            }
        }
    }
}
```

---

## ä¹ã€å®Œæ•´ç¤ºä¾‹ï¼šè§¦å‘åŒºåŸŸå¯è§†åŒ–

```csharp
using UnityEngine;

/// <summary>
/// è§¦å‘åŒºåŸŸå¯è§†åŒ–ç»„ä»¶
/// </summary>
public class TriggerZone : MonoBehaviour
{
    [Header("åŒºåŸŸè®¾ç½®")]
    public Vector3 zoneSize = new Vector3(3, 2, 3);
    public Color zoneColor = new Color(1, 0, 0, 0.2f);
    public Color borderColor = Color.red;

    [Header("è§¦å‘ä¿¡æ¯")]
    public string triggerTag = "Player";
    public bool oneTime = false;
    public bool hasTriggered = false;

    private void OnDrawGizmos()
    {
        // æ ¹æ®è§¦å‘çŠ¶æ€é€‰æ‹©é¢œè‰²
        Gizmos.color = hasTriggered ? Color.gray : zoneColor;

        // ç»˜åˆ¶è§¦å‘åŒºåŸŸ
        Gizmos.DrawCube(transform.position, zoneSize);

        // ç»˜åˆ¶è¾¹æ¡†
        Gizmos.color = hasTriggered ? Color.gray : borderColor;
        Gizmos.DrawWireCube(transform.position, zoneSize);

        // ç»˜åˆ¶å‘ä¸ŠæŒ‡ç¤ºç®­å¤´
        Gizmos.DrawRay(transform.position, Vector3.up * 2);
    }

    private void OnDrawGizmosSelected()
    {
        // é€‰ä¸­æ—¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
        string info = $"<color=yellow>{gameObject.name}</color>\n";
        info += $"Tag: {triggerTag}\n";
        info += $"OneTime: {oneTime}\n";
        info += $"Triggered: {hasTriggered}\n";
        info += $"Size: {zoneSize}";

        UnityEditor.Handles.Label(transform.position + Vector3.up * 2.5f, info);

        // æ˜¾ç¤ºç¢°æ’ç›’å¤§å°æ ‡æ³¨
        UnityEditor.Handles.Label(
            transform.position + Vector3.right * (zoneSize.x / 2 + 0.5f),
            $"<color=cyan>{zoneSize.x}m</color>"
        );
    }

    private void OnTriggerEnter(Collider other)
    {
        if (other.CompareTag(triggerTag))
        {
            if (oneTime && hasTriggered)
                return;

            hasTriggered = true;
            Debug.Log($"{gameObject.name} triggered by {other.name}");
        }
    }

    private void OnTriggerExit(Collider other)
    {
        if (!oneTime && other.CompareTag(triggerTag))
        {
            hasTriggered = false;
        }
    }
}
```

---

## åã€Gizmos ä¸ Handles é…åˆä½¿ç”¨

```csharp
using UnityEngine;
using UnityEditor;

/// <summary>
/// é…åˆä½¿ç”¨ Gizmos å’Œ Handles çš„å®Œæ•´ç¤ºä¾‹
/// </summary>
public class ZoneEditor : MonoBehaviour
{
    public float radius = 5f;
    public Color color = Color.cyan;
}

#if UNITY_EDITOR
[CustomEditor(typeof(ZoneEditor))]
public class ZoneEditorEditor : Editor
{
    private ZoneEditor zone;
    private SerializedProperty radiusProp;
    private SerializedProperty colorProp;

    void OnEnable()
    {
        zone = (ZoneEditor)target;
        radiusProp = serializedObject.FindProperty("radius");
        colorProp = serializedObject.FindProperty("color");
    }

    void OnSceneGUI()
    {
        // ä½¿ç”¨ Handles åˆ›å»ºå¯äº¤äº’çš„ç¼–è¾‘æ‰‹æŸ„
        EditorGUI.BeginChangeCheck();

        float newRadius = Handles.RadiusHandle(
            Quaternion.identity,
            zone.transform.position,
            zone.radius
        );

        if (EditorGUI.EndChangeCheck())
        {
            Undo.RecordObject(zone, "Change Radius");
            zone.radius = newRadius;
            EditorUtility.SetDirty(zone);
        }
    }
}
#endif

/// <summary>
/// è¿è¡Œæ—¶çš„ Gizmos å¯è§†åŒ–
/// </summary>
public class ZoneEditor : MonoBehaviour
{
    public float radius = 5f;
    public Color color = Color.cyan;

    private void OnDrawGizmos()
    {
        // ä½¿ç”¨ Gizmos ç»˜åˆ¶ä¸å¯äº¤äº’çš„è°ƒè¯•æ˜¾ç¤º
        Gizmos.color = new Color(color.r, color.g, color.b, 0.3f);
        Gizmos.DrawSphere(transform.position, radius);

        Gizmos.color = color;
        Gizmos.DrawWireSphere(transform.position, radius);
    }

    private void OnDrawGizmosSelected()
    {
        // é€‰ä¸­æ—¶æ˜¾ç¤ºé¢å¤–ä¿¡æ¯
        UnityEditor.Handles.Label(
            transform.position + Vector3.up * (radius + 1),
            $"<color=yellow>{gameObject.name}</color>\n" +
            $"Radius: {radius:F1}m"
        );
    }
}
```

---

## åä¸€ã€æœ€ä½³å®è·µ

### 11.1 æ€§èƒ½è€ƒè™‘

```csharp
// âŒ é¿å…ï¼šåœ¨ OnDrawGizmos ä¸­è¿›è¡Œå¤æ‚è®¡ç®—
private void OnDrawGizmos()
{
    // é¿å…æ¯å¸§é‡å¤è®¡ç®—
    var allEnemies = FindObjectsOfType<Enemy>();
    foreach (var enemy in allEnemies)
    {
        Gizmos.DrawWireSphere(enemy.transform.position, 1f);
    }
}

// âœ… æ¨èï¼šç¼“å­˜æ•°æ®ï¼Œç®€å•ç»˜åˆ¶
private List<Transform> cachedTargets;

void Start()
{
    // åªåœ¨åˆå§‹åŒ–æ—¶è®¡ç®—ä¸€æ¬¡
    cachedTargets = new List<Transform>();
    // ... å¡«å……æ•°æ®
}

private void OnDrawGizmos()
{
    // åªè´Ÿè´£ç»˜åˆ¶
    foreach (var target in cachedTargets)
    {
        Gizmos.DrawWireSphere(target.position, 1f);
    }
}
```

### 11.2 æ¡ä»¶æ¸²æŸ“

```csharp
// ä½¿ç”¨æ¡ä»¶ç¼–è¯‘ç¡®ä¿åªåœ¨ç¼–è¾‘å™¨ä¸­ç¼–è¯‘
#if UNITY_EDITOR
private void OnDrawGizmos()
{
    // Gizmos ä»£ç ...
}
#endif

// æˆ–è€…ä½¿ç”¨å®å®šä¹‰
private void OnDrawGizmos()
{
    #if UNITY_EDITOR
    Gizmos.DrawWireSphere(transform.position, radius);
    #endif
}
```

### 11.3 é¢œè‰²ç¼–ç è§„èŒƒ

```csharp
// æ¨èçš„é¢œè‰²ç¼–ç çº¦å®š
private void OnDrawGizmos()
{
    // ğŸŸ¢ ç»¿è‰² = å®‰å…¨/å‹å¥½
    Gizmos.color = Color.green;
    Gizmos.DrawWireSphere(safeZone.position, safeZone.radius);

    // ğŸŸ¡ é»„è‰² = è­¦å‘Š/æ³¨æ„
    Gizmos.color = Color.yellow;
    Gizmos.DrawWireSphere(warningZone.position, warningZone.radius);

    // ğŸ”´ çº¢è‰² = å±é™©/æ•Œäºº
    Gizmos.color = Color.red;
    Gizmos.DrawWireSphere(enemyZone.position, enemyZone.radius);

    // ğŸ”µ è“è‰² = ä¸­ç«‹/ä¿¡æ¯
    Gizmos.color = Color.blue;
    Gizmos.DrawWireSphere(infoZone.position, infoZone.radius);

    // ğŸŸ£ ç´«è‰² = ç‰¹æ®Š
    Gizmos.color = Color.magenta;
    Gizmos.DrawWireSphere(specialZone.position, specialZone.radius);
}
```

---

## åäºŒã€Gizmos é€ŸæŸ¥è¡¨

| æ–¹æ³• | æè¿° | å‚æ•° |
|------|------|------|
| **çº¿æ¡†å½¢çŠ¶** |||
| `DrawWireSphere()` | çº¿æ¡†çƒä½“ | `center, radius` |
| `DrawWireCube()` | çº¿æ¡†ç«‹æ–¹ä½“ | `center, size` |
| `DrawWireCapsule()` | çº¿æ¡†èƒ¶å›Šä½“ | `point, radius, height` |
| **å®å¿ƒå½¢çŠ¶** |||
| `DrawSphere()` | å®å¿ƒçƒä½“ | `center, radius` |
| `DrawCube()` | å®å¿ƒç«‹æ–¹ä½“ | `center, size` |
| **çº¿æ¡** |||
| `DrawLine()` | çº¿æ®µ | `start, end` |
| `DrawRay()` | å°„çº¿ | `origin, direction` |
| **å…¶ä»–** |||
| `DrawIcon()` | å›¾æ ‡ | `position, name` |
| `DrawFrustum()` | è§†é”¥ä½“ | `position, fov, far, near, aspect` |
| `DrawWireDisc()` | çº¿æ¡†åœ† | `position, normal, radius` |

---

## åä¸‰ã€æ€»ç»“

æœ¬æ–‡ä»‹ç»äº† Unity Gizmos çš„æ ¸å¿ƒçŸ¥è¯†ï¼š

| ä¸»é¢˜ | è¦ç‚¹ |
|------|------|
| **åŸºæœ¬æ¦‚å¿µ** | Scene è§†å›¾ä¸­çš„çº¯å¯è§†åŒ–è°ƒè¯•å…ƒç´  |
| **ç»˜åˆ¶æ—¶æœº** | OnDrawGizmosï¼ˆå§‹ç»ˆï¼‰/ OnDrawGizmosSelectedï¼ˆé€‰ä¸­æ—¶ï¼‰ |
| **å¸¸ç”¨æ–¹æ³•** | DrawWireSphere, DrawLine, DrawCube, DrawIcon |
| **é¢œè‰²è®¾ç½®** | Gizmos.color æ§åˆ¶ç»˜åˆ¶é¢œè‰² |
| **çŸ©é˜µå˜æ¢** | Gizmos.matrix å®ç°å±€éƒ¨ç©ºé—´ç»˜åˆ¶ |
| **ä¸ Handles åŒºåˆ«** | Gizmos ä¸å¯äº¤äº’ï¼ŒHandles å¯ç¼–è¾‘ |
| **æœ€ä½³å®è·µ** | æ¡ä»¶ç¼–è¯‘ã€æ€§èƒ½ä¼˜åŒ–ã€é¢œè‰²ç¼–ç  |

> ğŸ’¡ **å¼€å‘å»ºè®®**ï¼š
> - Gizmos åªç”¨äºè°ƒè¯•ï¼Œä¸è¦ç”¨äºæ¸¸æˆé€»è¾‘
> - ä½¿ç”¨ `#if UNITY_EDITOR` æ¡ä»¶ç¼–è¯‘
> - ä¸ºä¸åŒç±»å‹çš„èŒƒå›´ä½¿ç”¨ç»Ÿä¸€é¢œè‰²ç¼–ç 
> - å¤æ‚è®¡ç®—æ”¾åœ¨ Update ä¸­ï¼ŒOnDrawGizmos åªè´Ÿè´£ç»˜åˆ¶
> - ä¸ Handles é…åˆä½¿ç”¨ï¼Œå®ç°å®Œæ•´çš„å¯è§†åŒ–ç¼–è¾‘

---

**è½¬è½½è¯·æ³¨æ˜æ¥æº**ï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºï¼Œä¹Ÿå¯ä»¥é‚®ä»¶è‡³ 1487842110@qq.com
